"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const L=require("react/jsx-runtime"),y=require("react"),D="https://iframe.payconductor.ai/v1",O="http://localhost:5175",k=3e4,B="600px";var T=(e=>(e.Init="Init",e.Config="Config",e.Update="Update",e.ConfirmPayment="ConfirmPayment",e.Validate="Validate",e.Reset="Reset",e))(T||{}),I=(e=>(e.Ready="Ready",e.Error="Error",e.PaymentComplete="PaymentComplete",e.PaymentFailed="PaymentFailed",e.PaymentPending="PaymentPending",e.ValidationError="ValidationError",e.PaymentMethodSelected="PaymentMethodSelected",e))(I||{});const Q=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"),U=Q?O:D,v=[O,D],b=B,F=k,c={INIT:T.Init,CONFIG:T.Config,UPDATE:T.Update,CONFIRM_PAYMENT:T.ConfirmPayment,VALIDATE:T.Validate,RESET:T.Reset,READY:I.Ready,ERROR:I.Error,PAYMENT_COMPLETE:I.PaymentComplete,PAYMENT_FAILED:I.PaymentFailed,PAYMENT_PENDING:I.PaymentPending,VALIDATION_ERROR:I.ValidationError,PAYMENT_METHOD_SELECTED:I.PaymentMethodSelected},$={INVALID_CLIENT:"InvalidClient",INVALID_TOKEN:"InvalidToken",NETWORK_ERROR:"NetworkError",IFRAME_NOT_READY:"IframeNotReady",PAYMENT_DECLINED:"PaymentDeclined",VALIDATION_ERROR:"ValidationError",TIMEOUT:"Timeout"};function g(e){const n=new URLSearchParams({publicKey:e.publicKey});return`${U}?${n.toString()}`}function K(){return crypto.randomUUID()}function V(e,n){return n.includes(e)}function S(){return new Map}function M(e,n,r,t){return new Promise((i,s)=>{if(!e||!("contentWindow"in e)){s(new Error("Iframe not defined"));return}if(!(e!=null&&e.contentWindow)){s(new Error("Iframe not ready"));return}if(!n){s(new Error("Pending requests not initialized"));return}const m=K();n.set(m,{resolve:i,reject:s}),e.contentWindow.postMessage({type:r,data:t,requestId:m},"*"),setTimeout(()=>{n!=null&&n.has(m)&&(n.delete(m),s(new Error("Request timeout")))},F)})}function Y(e,n,r){return M(e,n,c.CONFIRM_PAYMENT,{orderId:r.orderId})}function J(e,n,r){return M(e,n,c.VALIDATE,r)}function X(e,n){return M(e,n,c.RESET)}function Z(e,n,r){return M(e,n,c.CONFIG,r)}function x(e,n,r){return M(e,n,c.INIT,r)}function p(e,n,r,t,i,s,m,h,f,E){if(!V(e.origin,v))return;const N=e.data,{requestId:R,type:w,data:u,error:P}=N;if(R&&(n!=null&&n.has(R))){const{resolve:d,reject:_}=n.get(R);n.delete(R),P?_(new Error(String(P.message))):d(u);return}if(w===c.READY){r(!0),i==null||i();return}if(w===c.ERROR){t((P==null?void 0:P.message)||"Unknown error"),s==null||s(new Error(String(P==null?void 0:P.message)));return}if(w===c.PAYMENT_COMPLETE){u&&typeof u=="object"&&"status"in u&&(m==null||m(u));return}if(w===c.PAYMENT_FAILED){u&&typeof u=="object"&&"status"in u&&(h==null||h(u));return}if(w===c.PAYMENT_PENDING){u&&typeof u=="object"&&"status"in u&&(f==null||f(u));return}if(w===c.PAYMENT_METHOD_SELECTED){u&&typeof u=="object"&&"paymentMethod"in u&&(E==null||E(u.paymentMethod));return}}function G(e){const[n,r]=y.useState(()=>!1),[t,i]=y.useState(()=>!1),[s,m]=y.useState(()=>null),[h,f]=y.useState(()=>""),[E,N]=y.useState(()=>null),[R,w]=y.useState(()=>null),[u,P]=y.useState(()=>!1);return y.useEffect(()=>{const d=(...a)=>{e.debug&&console.log("[PayConductor]",...a)};d("SDK initializing",{publicKey:e.publicKey});const _=g({publicKey:e.publicKey});f(_),r(!0),N(S()),d("iframeUrl built:",_),d("pendingMap created");const A=()=>{var o,l;const a=(l=(o=window.PayConductor)==null?void 0:o.frame)==null?void 0:l.iframe;if(a){if(a instanceof HTMLIFrameElement)return a;if(typeof a=="object"&&a!==null){if("current"in a)return a.current??void 0;if("value"in a)return a.value??void 0}return a}},H={iframe:null,iframeUrl:_,get isReady(){return t},get error(){return s}},z={publicKey:e.publicKey,theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod},q={confirmPayment:a=>(d("confirmPayment called",{orderId:a.orderId}),Y(A(),E,a)),validate:a=>(d("validate called",a),J(A(),E,a)),reset:()=>(d("reset called"),X(A(),E)),getSelectedPaymentMethod:()=>R};window.PayConductor={frame:H,config:z,api:q,selectedPaymentMethod:R},d("window.PayConductor registered"),window.dispatchEvent(new CustomEvent("payconductor:registered",{detail:window.PayConductor}));const W=async()=>{if(!u){const a=A();if(!a){d("sendConfigToIframe: iframe not found, skipping");return}P(!0),d("sendConfig →",{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons}),Z(a,E,{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons,nuPayConfig:e.nuPayConfig})}},j=a=>{p(a,E,o=>{i(o),o&&(d("iframe Ready — sending config"),W())},o=>{m(o),d("iframe Error:",o)},()=>{var o;d("onReady fired"),(o=e.onReady)==null||o.call(e)},o=>{var l;d("onError fired:",o),(l=e.onError)==null||l.call(e,o)},o=>{var l;d("PaymentComplete:",o),(l=e.onPaymentComplete)==null||l.call(e,o)},o=>{var l;d("PaymentFailed:",o),(l=e.onPaymentFailed)==null||l.call(e,o)},o=>{var l;d("PaymentPending:",o),(l=e.onPaymentPending)==null||l.call(e,o)},o=>{var l;d("PaymentMethodSelected:",o),w(o),window.PayConductor&&(window.PayConductor.selectedPaymentMethod=o),(l=e.onPaymentMethodSelected)==null||l.call(e,o)})};window.addEventListener("message",j),d("SDK initialized — waiting for PayConductorCheckoutElement")},[]),L.jsx("div",{className:"payconductor",id:"payconductor",style:{display:"contents"},children:e.children})}function ee(e){const n=y.useRef(null),[r,t]=y.useState(()=>""),[i,s]=y.useState(()=>!1);return y.useEffect(()=>{const m=f=>{f!=null&&f.frame&&(t(f.frame.iframeUrl||""),f.frame.iframe=n.current,console.log("[PayConductorCheckoutElement] iframe registered, src:",r),s(!0))},h=typeof window<"u"?window.PayConductor:null;if(h)m(h);else{const f=E=>{m(E.detail),window.removeEventListener("payconductor:registered",f)};window.addEventListener("payconductor:registered",f)}},[]),L.jsx("div",{className:"payconductor-element",style:{width:"100%"},children:i&&r&&n.current&&"contentWindow"in n.current?L.jsx("iframe",{allow:"payment",title:"PayConductor",ref:n,src:r,style:{width:"100%",height:e.height||b,border:"none"}}):null})}function te(){const e=typeof window<"u"?window.PayConductor:null,n=e!=null&&e.config?{publicKey:e.config.publicKey,orderId:e.config.orderId,theme:e.config.theme,locale:e.config.locale}:{},r=e!=null&&e.frame?{iframe:e.frame.iframe,isReady:e.frame.isReady,error:e.frame.error}:{iframe:null,isReady:!1,error:null};return{...n,...r}}function C(e){var r;if(!((r=e==null?void 0:e.frame)!=null&&r.iframe))return null;const n=e.frame.iframe;if(n instanceof HTMLIFrameElement)return n;if(n&&typeof n=="object"&&"value"in n){const t=n.value;if(t instanceof HTMLIFrameElement)return t}return null}function ne(){const e=typeof window<"u"?window.PayConductor:null,n=(r,t)=>{if(!e)return;const i=C(e);i!=null&&i.contentWindow&&i.contentWindow.postMessage({type:r,data:t},"*")};return e?{init:async r=>{const t=C(e),i=S();return x(t||void 0,i,r)},confirmPayment:async r=>{const t=C(e),i=S();if(!r.orderId)throw new Error("Order ID is required");return Y(t||void 0,i,r)},validate:e.api.validate,reset:e.api.reset,getSelectedPaymentMethod:()=>(e==null?void 0:e.selectedPaymentMethod)??null,updateConfig:r=>{const t=e.config;n(c.CONFIG,{publicKey:t==null?void 0:t.publicKey,orderId:t==null?void 0:t.orderId,theme:r.theme??(t==null?void 0:t.theme),locale:r.locale??(t==null?void 0:t.locale),paymentMethods:r.paymentMethods??(t==null?void 0:t.paymentMethods)})},updateorderId:r=>{const t=e.config;n(c.CONFIG,{publicKey:t==null?void 0:t.publicKey,orderId:r,theme:t==null?void 0:t.theme,locale:t==null?void 0:t.locale,paymentMethods:t==null?void 0:t.paymentMethods})},update:r=>{n(c.UPDATE,r)},submit:async()=>{const r=C(e),t=S();try{return await M(r||void 0,t,c.CONFIRM_PAYMENT,{}),{paymentMethod:void 0}}catch(i){return{error:{message:i instanceof Error?i.message:"Payment failed",code:"payment_error",type:"payment_error"}}}}}:{init:async()=>{throw new Error("PayConductor not initialized")},confirmPayment:async()=>{throw new Error("PayConductor not initialized")},validate:async()=>{throw new Error("PayConductor not initialized")},reset:async()=>{throw new Error("PayConductor not initialized")},getSelectedPaymentMethod:()=>null,updateConfig:()=>{throw new Error("PayConductor not initialized")},updateorderId:()=>{throw new Error("PayConductor not initialized")},update:()=>{throw new Error("PayConductor not initialized")},submit:async()=>{throw new Error("PayConductor not initialized")}}}exports.ALLOWED_ORIGINS=v;exports.ERROR_CODES=$;exports.IFRAME_BASE_URL=U;exports.IFRAME_DEFAULT_HEIGHT_VALUE=b;exports.POST_MESSAGES=c;exports.PayConductor=G;exports.PayConductorCheckoutElement=ee;exports.REQUEST_TIMEOUT=F;exports.buildIframeUrl=g;exports.default=G;exports.generateRequestId=K;exports.isValidOrigin=V;exports.usePayConductor=te;exports.usePayconductorElement=ne;
//# sourceMappingURL=index.cjs.js.map
