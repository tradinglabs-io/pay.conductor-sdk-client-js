"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const L=require("react/jsx-runtime"),E=require("react"),U="https://iframe.payconductor.ai/v1",D="http://localhost:5175/v1",g=3e4,Q="600px";var h=(e=>(e.Init="Init",e.Config="Config",e.Update="Update",e.ConfirmPayment="ConfirmPayment",e.Validate="Validate",e.Reset="Reset",e))(h||{}),R=(e=>(e.Ready="Ready",e.Error="Error",e.PaymentComplete="PaymentComplete",e.PaymentFailed="PaymentFailed",e.PaymentPending="PaymentPending",e.ValidationError="ValidationError",e.PaymentMethodSelected="PaymentMethodSelected",e))(R||{});const $=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&!window.location.search.includes("production"),v=$?D:U,F=[D,U],b=Q,V=g,s={INIT:h.Init,CONFIG:h.Config,UPDATE:h.Update,CONFIRM_PAYMENT:h.ConfirmPayment,VALIDATE:h.Validate,RESET:h.Reset,READY:R.Ready,ERROR:R.Error,PAYMENT_COMPLETE:R.PaymentComplete,PAYMENT_FAILED:R.PaymentFailed,PAYMENT_PENDING:R.PaymentPending,VALIDATION_ERROR:R.ValidationError,PAYMENT_METHOD_SELECTED:R.PaymentMethodSelected},z={INVALID_CLIENT:"InvalidClient",INVALID_TOKEN:"InvalidToken",NETWORK_ERROR:"NetworkError",IFRAME_NOT_READY:"IframeNotReady",PAYMENT_DECLINED:"PaymentDeclined",VALIDATION_ERROR:"ValidationError",TIMEOUT:"Timeout"};function Y(e){const r=new URLSearchParams({publicKey:e.publicKey});return`${v}?${r.toString()}`}function G(){return crypto.randomUUID()}function K(e,r){return r.some(t=>{try{return new URL(t).origin===e}catch{return t===e}})}function N(){return new Map}function _(e,r,t,n){return new Promise((o,u)=>{if(!e||!("contentWindow"in e)){u(new Error("Iframe not defined"));return}if(!(e!=null&&e.contentWindow)){u(new Error("Iframe not ready"));return}if(!r){u(new Error("Pending requests not initialized"));return}const l=G();r.set(l,{resolve:o,reject:u}),e.contentWindow.postMessage({type:t,data:n,requestId:l},"*"),setTimeout(()=>{r!=null&&r.has(l)&&(r.delete(l),u(new Error("Request timeout")))},V)})}function q(e,r,t){return _(e,r,s.CONFIRM_PAYMENT,{orderId:t.orderId})}function J(e,r,t){return _(e,r,s.VALIDATE,t)}function X(e,r){return _(e,r,s.RESET)}function Z(e,r,t){return _(e,r,s.CONFIG,t)}function x(e,r,t){return _(e,r,s.INIT,t)}function p(e,r,t,n,o,u,l,I,m,w){if(!K(e.origin,F))return;const C=e.data,{requestId:f,type:P,data:d,error:y}=C;if(f&&(r!=null&&r.has(f))){const{resolve:T,reject:M}=r.get(f);r.delete(f),y?M(new Error(String(y.message))):T(d);return}if(P===s.READY){t(!0),o==null||o();return}if(P===s.ERROR){n((y==null?void 0:y.message)||"Unknown error"),u==null||u(new Error(String(y==null?void 0:y.message)));return}if(P===s.PAYMENT_COMPLETE){d&&typeof d=="object"&&"status"in d&&(l==null||l(d));return}if(P===s.PAYMENT_FAILED){d&&typeof d=="object"&&"status"in d&&(I==null||I(d));return}if(P===s.PAYMENT_PENDING){d&&typeof d=="object"&&"status"in d&&(m==null||m(d));return}if(P===s.PAYMENT_METHOD_SELECTED){d&&typeof d=="object"&&"paymentMethod"in d&&(w==null||w(d.paymentMethod));return}}function H(e){const[r,t]=E.useState(()=>!1),[n,o]=E.useState(()=>!1),[u,l]=E.useState(()=>null),[I,m]=E.useState(()=>""),[w,C]=E.useState(()=>null);return E.useEffect(()=>{const f=(...a)=>{e.debug&&console.log("[PayConductor]",...a)},P=Y({publicKey:e.publicKey});m(P),t(!0);const d=N();let y=!1;f("init",e.publicKey),f("iframeUrl",P);const T=()=>{var A,i;const a=(i=(A=window.PayConductor)==null?void 0:A.frame)==null?void 0:i.iframe;if(a){if(a instanceof HTMLIFrameElement)return a;if(typeof a=="object"&&a!==null){if("current"in a)return a.current??void 0;if("value"in a)return a.value??void 0}return a}return document.querySelector(".payconductor-element iframe")??void 0},M={iframe:null,iframeUrl:P,isReady:!1,error:null},j={publicKey:e.publicKey,theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod},B={confirmPayment:a=>(f("→ CONFIRM_PAYMENT",{orderId:a.orderId}),q(T(),d,a)),validate:a=>(f("→ VALIDATE",a),J(T(),d,a)),reset:()=>(f("→ RESET"),X(T(),d)),getSelectedPaymentMethod:()=>w};window.PayConductor={frame:M,config:j,api:B,selectedPaymentMethod:w};const O=document.querySelector(".payconductor-element iframe");O&&(M.iframe=O),f("registered"),window.dispatchEvent(new CustomEvent("payconductor:registered",{detail:window.PayConductor}));const W=async()=>{if(!y){const a=T();if(!a){f("→ CONFIG skipped: iframe not found");return}y=!0,f("→ CONFIG",{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons}),Z(a,d,{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons,nuPayConfig:e.nuPayConfig})}},k=a=>{var A;(A=a.data)!=null&&A.type&&f("←",a.data.type,a.data.data??""),p(a,d,i=>{var c;o(i),M.isReady=i,(c=window.PayConductor)!=null&&c.frame&&(window.PayConductor.frame.isReady=i),i&&W()},i=>{var c;l(i),M.error=i,(c=window.PayConductor)!=null&&c.frame&&(window.PayConductor.frame.error=i)},()=>{var i;(i=e.onReady)==null||i.call(e)},i=>{var c;(c=e.onError)==null||c.call(e,i)},i=>{var c;(c=e.onPaymentComplete)==null||c.call(e,i)},i=>{var c;(c=e.onPaymentFailed)==null||c.call(e,i)},i=>{var c;(c=e.onPaymentPending)==null||c.call(e,i)},i=>{var c;C(i),window.PayConductor&&(window.PayConductor.selectedPaymentMethod=i),(c=e.onPaymentMethodSelected)==null||c.call(e,i)})};window.addEventListener("message",k)},[]),L.jsx("div",{className:"payconductor",id:"payconductor",style:{display:"contents"},children:e.children})}function ee(e){const r=E.useRef(null),[t,n]=E.useState(()=>""),[o,u]=E.useState(()=>!1);return E.useEffect(()=>{const l=m=>{m!=null&&m.frame&&(n(m.frame.iframeUrl||""),u(!0))},I=typeof window<"u"?window.PayConductor:null;if(I)l(I);else{const m=w=>{l(w.detail),window.removeEventListener("payconductor:registered",m)};window.addEventListener("payconductor:registered",m)}},[]),E.useEffect(()=>{var l;if(o&&t&&((l=window.PayConductor)!=null&&l.frame)){const I=r.current||document.querySelector(".payconductor-element iframe");I&&(window.PayConductor.frame.iframe=I)}},[o,t]),L.jsx("div",{className:"payconductor-element",style:{width:"100%"},children:o&&t?L.jsx("iframe",{allow:"payment",title:"PayConductor",ref:r,src:t,style:{width:"100%",height:e.height||b,border:"none"}}):null})}function te(){const e=typeof window<"u"?window.PayConductor:null,r=e!=null&&e.config?{publicKey:e.config.publicKey,orderId:e.config.orderId,theme:e.config.theme,locale:e.config.locale}:{},t=e!=null&&e.frame?{iframe:e.frame.iframe,isReady:e.frame.isReady,error:e.frame.error}:{iframe:null,isReady:!1,error:null};return{...r,...t}}function S(e){var r;if((r=e==null?void 0:e.frame)!=null&&r.iframe){const t=e.frame.iframe;if(t instanceof HTMLIFrameElement)return t;if(t&&typeof t=="object"){if("current"in t){const n=t.current;if(n instanceof HTMLIFrameElement)return n}if("value"in t){const n=t.value;if(n instanceof HTMLIFrameElement)return n}}}return document.querySelector(".payconductor-element iframe")??null}function ne(){const e=()=>typeof window<"u"?window.PayConductor:null,r=(t,n)=>{const o=e();if(!o)return;const u=S(o);u!=null&&u.contentWindow&&u.contentWindow.postMessage({type:t,data:n},"*")};return{init:async t=>{const n=S(e()),o=N();return x(n||void 0,o,t)},confirmPayment:async t=>{const n=S(e()),o=N();if(!t.orderId)throw new Error("Order ID is required");return q(n||void 0,o,t)},validate:t=>{const n=e();return n?n.api.validate(t):Promise.resolve(!1)},reset:()=>{const t=e();return t?t.api.reset():Promise.resolve()},getSelectedPaymentMethod:()=>{var t;return((t=e())==null?void 0:t.selectedPaymentMethod)??null},updateConfig:t=>{var o;const n=(o=e())==null?void 0:o.config;r(s.CONFIG,{publicKey:n==null?void 0:n.publicKey,orderId:n==null?void 0:n.orderId,theme:t.theme??(n==null?void 0:n.theme),locale:t.locale??(n==null?void 0:n.locale),paymentMethods:t.paymentMethods??(n==null?void 0:n.paymentMethods)})},updateorderId:t=>{var o;const n=(o=e())==null?void 0:o.config;r(s.CONFIG,{publicKey:n==null?void 0:n.publicKey,orderId:t,theme:n==null?void 0:n.theme,locale:n==null?void 0:n.locale,paymentMethods:n==null?void 0:n.paymentMethods})},update:t=>{r(s.UPDATE,t)},submit:async()=>{const t=S(e()),n=N();try{return await _(t||void 0,n,s.CONFIRM_PAYMENT,{}),{paymentMethod:void 0}}catch(o){return{error:{message:o instanceof Error?o.message:"Payment failed",code:"payment_error",type:"payment_error"}}}}}}exports.ALLOWED_ORIGINS=F;exports.ERROR_CODES=z;exports.IFRAME_BASE_URL=v;exports.IFRAME_DEFAULT_HEIGHT_VALUE=b;exports.POST_MESSAGES=s;exports.PayConductor=H;exports.PayConductorCheckoutElement=ee;exports.REQUEST_TIMEOUT=V;exports.buildIframeUrl=Y;exports.default=H;exports.generateRequestId=G;exports.isValidOrigin=K;exports.usePayConductor=te;exports.usePayconductorElement=ne;
//# sourceMappingURL=index.cjs.js.map
