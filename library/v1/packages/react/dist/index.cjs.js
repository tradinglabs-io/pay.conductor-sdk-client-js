"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const O=require("react/jsx-runtime"),f=require("react"),D="https://iframe.payconductor.ai",L="http://localhost:5175",W=3e4,j="600px";var T=(e=>(e.Init="Init",e.Config="Config",e.Update="Update",e.ConfirmPayment="ConfirmPayment",e.Validate="Validate",e.Reset="Reset",e))(T||{}),y=(e=>(e.Ready="Ready",e.Error="Error",e.PaymentComplete="PaymentComplete",e.PaymentFailed="PaymentFailed",e.PaymentPending="PaymentPending",e.ValidationError="ValidationError",e.PaymentMethodSelected="PaymentMethodSelected",e))(y||{});const B=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.port==="5175"),C=B?L:D,U=[L,D],b=j,F=W,i={INIT:T.Init,CONFIG:T.Config,UPDATE:T.Update,CONFIRM_PAYMENT:T.ConfirmPayment,VALIDATE:T.Validate,RESET:T.Reset,READY:y.Ready,ERROR:y.Error,PAYMENT_COMPLETE:y.PaymentComplete,PAYMENT_FAILED:y.PaymentFailed,PAYMENT_PENDING:y.PaymentPending,VALIDATION_ERROR:y.ValidationError,PAYMENT_METHOD_SELECTED:y.PaymentMethodSelected},Q={INVALID_CLIENT:"InvalidClient",INVALID_TOKEN:"InvalidToken",NETWORK_ERROR:"NetworkError",IFRAME_NOT_READY:"IframeNotReady",PAYMENT_DECLINED:"PaymentDeclined",VALIDATION_ERROR:"ValidationError",TIMEOUT:"Timeout"};function v(e){const t=new URLSearchParams({publicKey:e.publicKey});return`${C}?${t.toString()}`}function V(){return crypto.randomUUID()}function k(e,t){return t.includes(e)}function N(){return new Map}function _(e,t,o,n){return new Promise((r,u)=>{if(!e||!("contentWindow"in e)){u(new Error("Iframe not defined"));return}if(!(e!=null&&e.contentWindow)){u(new Error("Iframe not ready"));return}if(!t){u(new Error("Pending requests not initialized"));return}const c=V();t.set(c,{resolve:r,reject:u}),e.contentWindow.postMessage({type:o,data:n,requestId:c},"*"),setTimeout(()=>{t!=null&&t.has(c)&&(t.delete(c),u(new Error("Request timeout")))},F)})}function Y(e,t,o){return _(e,t,i.CONFIRM_PAYMENT,{intentToken:o.intentToken})}function $(e,t,o){return _(e,t,i.VALIDATE,o)}function J(e,t){return _(e,t,i.RESET)}function X(e,t,o){return _(e,t,i.CONFIG,o)}function Z(e,t,o,n,r,u,c,R,I,w){if(!k(e.origin,U))return;const m=e.data,{requestId:P,type:E,data:a,error:s}=m;if(P&&(t!=null&&t.has(P))){const{resolve:A,reject:M}=t.get(P);t.delete(P),s?M(new Error(s.message)):A(a);return}if(E===i.READY){o(!0),r==null||r();return}if(E===i.ERROR){n((s==null?void 0:s.message)||"Unknown error"),u==null||u(new Error(s==null?void 0:s.message));return}if(E===i.PAYMENT_COMPLETE){a&&typeof a=="object"&&"status"in a&&(c==null||c(a));return}if(E===i.PAYMENT_FAILED){a&&typeof a=="object"&&"status"in a&&(R==null||R(a));return}if(E===i.PAYMENT_PENDING){a&&typeof a=="object"&&"status"in a&&(I==null||I(a));return}if(E===i.PAYMENT_METHOD_SELECTED){a&&typeof a=="object"&&"paymentMethod"in a&&(w==null||w(a.paymentMethod));return}}function K(e){const t=f.useRef(null),[o,n]=f.useState(()=>!1),[r,u]=f.useState(()=>!1),[c,R]=f.useState(()=>null),[I,w]=f.useState(()=>""),[m,P]=f.useState(()=>null),[E,a]=f.useState(()=>null),[s,A]=f.useState(()=>!1);return f.useEffect(()=>{w(v({publicKey:e.publicKey})),n(!0),P(N());const M={iframe:t.current,get isReady(){return r},get error(){return c}},G={publicKey:e.publicKey,intentToken:e.intentToken,theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod},H={confirmPayment:h=>Y(t.current,m,h),validate:h=>$(t.current,m,h),reset:()=>J(t.current,m),getSelectedPaymentMethod:()=>E};window.PayConductor={frame:M,config:G,api:H,selectedPaymentMethod:E};const q=async()=>{!s&&t.current&&(A(!0),X(t.current,m,{intentToken:e.intentToken,theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons,nuPayConfig:e.nuPayConfig}))},z=h=>{Z(h,m,d=>{u(d),d&&q()},d=>{R(d)},e.onReady,e.onError,d=>{var l;return(l=e.onPaymentComplete)==null?void 0:l.call(e,d)},d=>{var l;return(l=e.onPaymentFailed)==null?void 0:l.call(e,d)},d=>{var l;return(l=e.onPaymentPending)==null?void 0:l.call(e,d)},d=>{var l;a(d),window.PayConductor&&(window.PayConductor.selectedPaymentMethod=d),(l=e.onPaymentMethodSelected)==null||l.call(e,d)})};window.addEventListener("message",z)},[]),O.jsxs("div",{className:"payconductor",id:"payconductor",style:{width:"100%",position:"relative"},children:[e.children,o?O.jsx("iframe",{allow:"payment",title:"PayConductor",ref:t,src:I,style:{width:"100%",height:e.height||b,border:"none"}}):null]})}function g(){const e=typeof window<"u"?window.PayConductor:null,t=e!=null&&e.config?{publicKey:e.config.publicKey,intentToken:e.config.intentToken,theme:e.config.theme,locale:e.config.locale}:{},o=e!=null&&e.frame?{iframe:e.frame.iframe,isReady:e.frame.isReady,error:e.frame.error}:{iframe:null,isReady:!1,error:null};return{...t,...o}}function S(e){var o;if(!((o=e==null?void 0:e.frame)!=null&&o.iframe))return null;const t=e.frame.iframe;if(t instanceof HTMLIFrameElement)return t;if(t&&typeof t=="object"&&"value"in t){const n=t.value;if(n instanceof HTMLIFrameElement)return n}return null}function x(){const e=typeof window<"u"?window.PayConductor:null,t=(o,n)=>{if(!e)return;const r=S(e);r!=null&&r.contentWindow&&r.contentWindow.postMessage({type:o,data:n},"*")};return e?{confirmPayment:async o=>{const n=S(e),r=N();if(!o.intentToken)throw new Error("Intent token is required");return Y(n||void 0,r,o)},validate:e.api.validate,reset:e.api.reset,getSelectedPaymentMethod:()=>(e==null?void 0:e.selectedPaymentMethod)??null,updateConfig:o=>{const n=e.config;t(i.CONFIG,{publicKey:n==null?void 0:n.publicKey,intentToken:n==null?void 0:n.intentToken,theme:o.theme??(n==null?void 0:n.theme),locale:o.locale??(n==null?void 0:n.locale),paymentMethods:o.paymentMethods??(n==null?void 0:n.paymentMethods)})},updateIntentToken:o=>{const n=e.config;t(i.CONFIG,{publicKey:n==null?void 0:n.publicKey,intentToken:o,theme:n==null?void 0:n.theme,locale:n==null?void 0:n.locale,paymentMethods:n==null?void 0:n.paymentMethods})},update:o=>{t(i.UPDATE,o)},submit:async()=>{const o=S(e),n=N();try{return await _(o||void 0,n,i.CONFIRM_PAYMENT,{}),{paymentMethod:void 0}}catch(r){return{error:{message:r instanceof Error?r.message:"Payment failed",code:"payment_error",type:"payment_error"}}}}}:{confirmPayment:async()=>{throw new Error("PayConductor not initialized")},validate:async()=>{throw new Error("PayConductor not initialized")},reset:async()=>{throw new Error("PayConductor not initialized")},getSelectedPaymentMethod:()=>null,updateConfig:()=>{throw new Error("PayConductor not initialized")},updateIntentToken:()=>{throw new Error("PayConductor not initialized")},update:()=>{throw new Error("PayConductor not initialized")},submit:async()=>{throw new Error("PayConductor not initialized")}}}exports.ALLOWED_ORIGINS=U;exports.ERROR_CODES=Q;exports.IFRAME_BASE_URL=C;exports.IFRAME_DEFAULT_HEIGHT_VALUE=b;exports.POST_MESSAGES=i;exports.PayConductor=K;exports.REQUEST_TIMEOUT=F;exports.buildIframeUrl=v;exports.default=K;exports.generateRequestId=V;exports.isValidOrigin=k;exports.useElement=x;exports.usePayConductor=g;
//# sourceMappingURL=index.cjs.js.map
