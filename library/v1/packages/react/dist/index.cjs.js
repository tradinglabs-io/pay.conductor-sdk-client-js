"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const N=require("react/jsx-runtime"),P=require("react"),L="https://iframe.payconductor.ai/v1",D="http://localhost:5175/v1",k=3e4,B="600px";var h=(e=>(e.Init="Init",e.Config="Config",e.Update="Update",e.ConfirmPayment="ConfirmPayment",e.Validate="Validate",e.Reset="Reset",e))(h||{}),w=(e=>(e.Ready="Ready",e.Error="Error",e.PaymentComplete="PaymentComplete",e.PaymentFailed="PaymentFailed",e.PaymentPending="PaymentPending",e.ValidationError="ValidationError",e.PaymentMethodSelected="PaymentMethodSelected",e))(w||{});const W=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&!window.location.search.includes("production"),O=W?D:L,U=[D,L],v=B,b=k,s={INIT:h.Init,CONFIG:h.Config,UPDATE:h.Update,CONFIRM_PAYMENT:h.ConfirmPayment,VALIDATE:h.Validate,RESET:h.Reset,READY:w.Ready,ERROR:w.Error,PAYMENT_COMPLETE:w.PaymentComplete,PAYMENT_FAILED:w.PaymentFailed,PAYMENT_PENDING:w.PaymentPending,VALIDATION_ERROR:w.ValidationError,PAYMENT_METHOD_SELECTED:w.PaymentMethodSelected},z={INVALID_CLIENT:"InvalidClient",INVALID_TOKEN:"InvalidToken",NETWORK_ERROR:"NetworkError",IFRAME_NOT_READY:"IframeNotReady",PAYMENT_DECLINED:"PaymentDeclined",VALIDATION_ERROR:"ValidationError",TIMEOUT:"Timeout"};function F(e){const r=new URLSearchParams({publicKey:e.publicKey});return`${O}?${r.toString()}`}function K(){return crypto.randomUUID()}function V(e,r){return r.includes(e)}function C(){return new Map}function M(e,r,t,n){return new Promise((a,u)=>{if(!e||!("contentWindow"in e)){u(new Error("Iframe not defined"));return}if(!(e!=null&&e.contentWindow)){u(new Error("Iframe not ready"));return}if(!r){u(new Error("Pending requests not initialized"));return}const m=K();r.set(m,{resolve:a,reject:u}),e.contentWindow.postMessage({type:t,data:n,requestId:m},"*"),setTimeout(()=>{r!=null&&r.has(m)&&(r.delete(m),u(new Error("Request timeout")))},b)})}function Y(e,r,t){return M(e,r,s.CONFIRM_PAYMENT,{orderId:t.orderId})}function Q(e,r,t){return M(e,r,s.VALIDATE,t)}function $(e,r){return M(e,r,s.RESET)}function J(e,r,t){return M(e,r,s.CONFIG,t)}function X(e,r,t){return M(e,r,s.INIT,t)}function Z(e,r,t,n,a,u,m,R,f,I){if(!V(e.origin,U))return;const S=e.data,{requestId:i,type:E,data:d,error:y}=S;if(i&&(r!=null&&r.has(i))){const{resolve:T,reject:_}=r.get(i);r.delete(i),y?_(new Error(String(y.message))):T(d);return}if(E===s.READY){t(!0),a==null||a();return}if(E===s.ERROR){n((y==null?void 0:y.message)||"Unknown error"),u==null||u(new Error(String(y==null?void 0:y.message)));return}if(E===s.PAYMENT_COMPLETE){d&&typeof d=="object"&&"status"in d&&(m==null||m(d));return}if(E===s.PAYMENT_FAILED){d&&typeof d=="object"&&"status"in d&&(R==null||R(d));return}if(E===s.PAYMENT_PENDING){d&&typeof d=="object"&&"status"in d&&(f==null||f(d));return}if(E===s.PAYMENT_METHOD_SELECTED){d&&typeof d=="object"&&"paymentMethod"in d&&(I==null||I(d.paymentMethod));return}}function g(e){const[r,t]=P.useState(()=>!1),[n,a]=P.useState(()=>!1),[u,m]=P.useState(()=>null),[R,f]=P.useState(()=>""),[I,S]=P.useState(()=>null);return P.useEffect(()=>{const i=(...c)=>{e.debug&&console.log("[PayConductor]",...c)};i("SDK initializing",{publicKey:e.publicKey});const E=F({publicKey:e.publicKey});f(E),t(!0);const d=C();let y=!1;i("iframeUrl built:",E),i("pendingMap created");const T=()=>{var o,l;const c=(l=(o=window.PayConductor)==null?void 0:o.frame)==null?void 0:l.iframe;if(c){if(c instanceof HTMLIFrameElement)return c;if(typeof c=="object"&&c!==null){if("current"in c)return c.current??void 0;if("value"in c)return c.value??void 0}return c}return document.querySelector(".payconductor-element iframe")??void 0},_={iframe:null,iframeUrl:E,isReady:!1,error:null},G={publicKey:e.publicKey,theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod},H={confirmPayment:c=>(i("confirmPayment called",{orderId:c.orderId}),Y(T(),d,c)),validate:c=>(i("validate called",c),Q(T(),d,c)),reset:()=>(i("reset called"),$(T(),d)),getSelectedPaymentMethod:()=>I};window.PayConductor={frame:_,config:G,api:H,selectedPaymentMethod:I},i("window.PayConductor registered"),window.dispatchEvent(new CustomEvent("payconductor:registered",{detail:window.PayConductor}));const q=async()=>{if(!y){const c=T();if(!c){i("sendConfigToIframe: iframe not found, skipping");return}y=!0,i("sendConfig →",{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons}),J(c,d,{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons,nuPayConfig:e.nuPayConfig})}},j=c=>{Z(c,d,o=>{a(o),_.isReady=o,window.PayConductor&&window.PayConductor.frame&&(window.PayConductor.frame.isReady=o),o&&(i("iframe Ready — sending config"),q())},o=>{m(o),_.error=o,window.PayConductor&&window.PayConductor.frame&&(window.PayConductor.frame.error=o),i("iframe Error:",o)},()=>{var o;i("onReady fired"),(o=e.onReady)==null||o.call(e)},o=>{var l;i("onError fired:",o),(l=e.onError)==null||l.call(e,o)},o=>{var l;i("PaymentComplete:",o),(l=e.onPaymentComplete)==null||l.call(e,o)},o=>{var l;i("PaymentFailed:",o),(l=e.onPaymentFailed)==null||l.call(e,o)},o=>{var l;i("PaymentPending:",o),(l=e.onPaymentPending)==null||l.call(e,o)},o=>{var l;i("PaymentMethodSelected:",o),S(o),window.PayConductor&&(window.PayConductor.selectedPaymentMethod=o),(l=e.onPaymentMethodSelected)==null||l.call(e,o)})};window.addEventListener("message",j),i("SDK initialized — waiting for PayConductorCheckoutElement")},[]),N.jsx("div",{className:"payconductor",id:"payconductor",style:{display:"contents"},children:e.children})}function x(e){const r=P.useRef(null),[t,n]=P.useState(()=>""),[a,u]=P.useState(()=>!1);return P.useEffect(()=>{const m=f=>{f!=null&&f.frame&&(n(f.frame.iframeUrl||""),f.frame.iframe=r.current,console.log("[PayConductorCheckoutElement] iframe registered, src:",t),u(!0))},R=typeof window<"u"?window.PayConductor:null;if(R)m(R);else{const f=I=>{m(I.detail),window.removeEventListener("payconductor:registered",f)};window.addEventListener("payconductor:registered",f)}},[]),N.jsx("div",{className:"payconductor-element",style:{width:"100%"},children:a&&t?N.jsx("iframe",{allow:"payment",title:"PayConductor",ref:r,src:t,style:{width:"100%",height:e.height||v,border:"none"}}):null})}function p(){const e=typeof window<"u"?window.PayConductor:null,r=e!=null&&e.config?{publicKey:e.config.publicKey,orderId:e.config.orderId,theme:e.config.theme,locale:e.config.locale}:{},t=e!=null&&e.frame?{iframe:e.frame.iframe,isReady:e.frame.isReady,error:e.frame.error}:{iframe:null,isReady:!1,error:null};return{...r,...t}}function A(e){var r;if((r=e==null?void 0:e.frame)!=null&&r.iframe){const t=e.frame.iframe;if(t instanceof HTMLIFrameElement)return t;if(t&&typeof t=="object"){if("current"in t){const n=t.current;if(n instanceof HTMLIFrameElement)return n}if("value"in t){const n=t.value;if(n instanceof HTMLIFrameElement)return n}}}return document.querySelector(".payconductor-element iframe")??null}function ee(){const e=()=>typeof window<"u"?window.PayConductor:null,r=(t,n)=>{const a=e();if(!a)return;const u=A(a);u!=null&&u.contentWindow&&u.contentWindow.postMessage({type:t,data:n},"*")};return{init:async t=>{const n=A(e()),a=C();return X(n||void 0,a,t)},confirmPayment:async t=>{const n=A(e()),a=C();if(!t.orderId)throw new Error("Order ID is required");return Y(n||void 0,a,t)},validate:t=>{const n=e();return n?n.api.validate(t):Promise.resolve(!1)},reset:()=>{const t=e();return t?t.api.reset():Promise.resolve()},getSelectedPaymentMethod:()=>{var t;return((t=e())==null?void 0:t.selectedPaymentMethod)??null},updateConfig:t=>{var a;const n=(a=e())==null?void 0:a.config;r(s.CONFIG,{publicKey:n==null?void 0:n.publicKey,orderId:n==null?void 0:n.orderId,theme:t.theme??(n==null?void 0:n.theme),locale:t.locale??(n==null?void 0:n.locale),paymentMethods:t.paymentMethods??(n==null?void 0:n.paymentMethods)})},updateorderId:t=>{var a;const n=(a=e())==null?void 0:a.config;r(s.CONFIG,{publicKey:n==null?void 0:n.publicKey,orderId:t,theme:n==null?void 0:n.theme,locale:n==null?void 0:n.locale,paymentMethods:n==null?void 0:n.paymentMethods})},update:t=>{r(s.UPDATE,t)},submit:async()=>{const t=A(e()),n=C();try{return await M(t||void 0,n,s.CONFIRM_PAYMENT,{}),{paymentMethod:void 0}}catch(a){return{error:{message:a instanceof Error?a.message:"Payment failed",code:"payment_error",type:"payment_error"}}}}}}exports.ALLOWED_ORIGINS=U;exports.ERROR_CODES=z;exports.IFRAME_BASE_URL=O;exports.IFRAME_DEFAULT_HEIGHT_VALUE=v;exports.POST_MESSAGES=s;exports.PayConductor=g;exports.PayConductorCheckoutElement=x;exports.REQUEST_TIMEOUT=b;exports.buildIframeUrl=F;exports.default=g;exports.generateRequestId=K;exports.isValidOrigin=V;exports.usePayConductor=p;exports.usePayconductorElement=ee;
//# sourceMappingURL=index.cjs.js.map
