"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const L=require("react/jsx-runtime"),y=require("react"),D="https://iframe.payconductor.ai/v1",O="http://localhost:5175",W=3e4,z="600px";var T=(e=>(e.Init="Init",e.Config="Config",e.Update="Update",e.ConfirmPayment="ConfirmPayment",e.Validate="Validate",e.Reset="Reset",e))(T||{}),R=(e=>(e.Ready="Ready",e.Error="Error",e.PaymentComplete="PaymentComplete",e.PaymentFailed="PaymentFailed",e.PaymentPending="PaymentPending",e.ValidationError="ValidationError",e.PaymentMethodSelected="PaymentMethodSelected",e))(R||{});const Q=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"),U=Q?O:D,v=[O,D],b=z,F=W,s={INIT:T.Init,CONFIG:T.Config,UPDATE:T.Update,CONFIRM_PAYMENT:T.ConfirmPayment,VALIDATE:T.Validate,RESET:T.Reset,READY:R.Ready,ERROR:R.Error,PAYMENT_COMPLETE:R.PaymentComplete,PAYMENT_FAILED:R.PaymentFailed,PAYMENT_PENDING:R.PaymentPending,VALIDATION_ERROR:R.ValidationError,PAYMENT_METHOD_SELECTED:R.PaymentMethodSelected},$={INVALID_CLIENT:"InvalidClient",INVALID_TOKEN:"InvalidToken",NETWORK_ERROR:"NetworkError",IFRAME_NOT_READY:"IframeNotReady",PAYMENT_DECLINED:"PaymentDeclined",VALIDATION_ERROR:"ValidationError",TIMEOUT:"Timeout"};function K(e){const r=new URLSearchParams({publicKey:e.publicKey});return`${U}?${r.toString()}`}function V(){return crypto.randomUUID()}function g(e,r){return r.includes(e)}function C(){return new Map}function M(e,r,t,n){return new Promise((a,c)=>{if(!e||!("contentWindow"in e)){c(new Error("Iframe not defined"));return}if(!(e!=null&&e.contentWindow)){c(new Error("Iframe not ready"));return}if(!r){c(new Error("Pending requests not initialized"));return}const m=V();r.set(m,{resolve:a,reject:c}),e.contentWindow.postMessage({type:t,data:n,requestId:m},"*"),setTimeout(()=>{r!=null&&r.has(m)&&(r.delete(m),c(new Error("Request timeout")))},F)})}function Y(e,r,t){return M(e,r,s.CONFIRM_PAYMENT,{orderId:t.orderId})}function J(e,r,t){return M(e,r,s.VALIDATE,t)}function X(e,r){return M(e,r,s.RESET)}function Z(e,r,t){return M(e,r,s.CONFIG,t)}function x(e,r,t){return M(e,r,s.INIT,t)}function p(e,r,t,n,a,c,m,h,f,E){if(!g(e.origin,v))return;const N=e.data,{requestId:w,type:I,data:u,error:P}=N;if(w&&(r!=null&&r.has(w))){const{resolve:d,reject:_}=r.get(w);r.delete(w),P?_(new Error(String(P.message))):d(u);return}if(I===s.READY){t(!0),a==null||a();return}if(I===s.ERROR){n((P==null?void 0:P.message)||"Unknown error"),c==null||c(new Error(String(P==null?void 0:P.message)));return}if(I===s.PAYMENT_COMPLETE){u&&typeof u=="object"&&"status"in u&&(m==null||m(u));return}if(I===s.PAYMENT_FAILED){u&&typeof u=="object"&&"status"in u&&(h==null||h(u));return}if(I===s.PAYMENT_PENDING){u&&typeof u=="object"&&"status"in u&&(f==null||f(u));return}if(I===s.PAYMENT_METHOD_SELECTED){u&&typeof u=="object"&&"paymentMethod"in u&&(E==null||E(u.paymentMethod));return}}function G(e){const[r,t]=y.useState(()=>!1),[n,a]=y.useState(()=>!1),[c,m]=y.useState(()=>null),[h,f]=y.useState(()=>""),[E,N]=y.useState(()=>null),[w,I]=y.useState(()=>null),[u,P]=y.useState(()=>!1);return y.useEffect(()=>{const d=(...i)=>{e.debug&&console.log("[PayConductor]",...i)};d("SDK initializing",{publicKey:e.publicKey});const _=K({publicKey:e.publicKey});f(_),t(!0),N(C()),d("iframeUrl built:",_),d("pendingMap created");const A=()=>{var o,l;const i=(l=(o=window.PayConductor)==null?void 0:o.frame)==null?void 0:l.iframe;if(i){if(i instanceof HTMLIFrameElement)return i;if(typeof i=="object"&&i!==null){if("current"in i)return i.current??void 0;if("value"in i)return i.value??void 0}return i}return document.querySelector(".payconductor-element iframe")??void 0},H={iframe:null,iframeUrl:_,get isReady(){return n},get error(){return c}},q={publicKey:e.publicKey,theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod},j={confirmPayment:i=>(d("confirmPayment called",{orderId:i.orderId}),Y(A(),E,i)),validate:i=>(d("validate called",i),J(A(),E,i)),reset:()=>(d("reset called"),X(A(),E)),getSelectedPaymentMethod:()=>w};window.PayConductor={frame:H,config:q,api:j,selectedPaymentMethod:w},d("window.PayConductor registered"),window.dispatchEvent(new CustomEvent("payconductor:registered",{detail:window.PayConductor}));const k=async()=>{if(!u){const i=A();if(!i){d("sendConfigToIframe: iframe not found, skipping");return}P(!0),d("sendConfig →",{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons}),Z(i,E,{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons,nuPayConfig:e.nuPayConfig})}},B=i=>{p(i,E,o=>{a(o),o&&(d("iframe Ready — sending config"),k())},o=>{m(o),d("iframe Error:",o)},()=>{var o;d("onReady fired"),(o=e.onReady)==null||o.call(e)},o=>{var l;d("onError fired:",o),(l=e.onError)==null||l.call(e,o)},o=>{var l;d("PaymentComplete:",o),(l=e.onPaymentComplete)==null||l.call(e,o)},o=>{var l;d("PaymentFailed:",o),(l=e.onPaymentFailed)==null||l.call(e,o)},o=>{var l;d("PaymentPending:",o),(l=e.onPaymentPending)==null||l.call(e,o)},o=>{var l;d("PaymentMethodSelected:",o),I(o),window.PayConductor&&(window.PayConductor.selectedPaymentMethod=o),(l=e.onPaymentMethodSelected)==null||l.call(e,o)})};window.addEventListener("message",B),d("SDK initialized — waiting for PayConductorCheckoutElement")},[]),L.jsx("div",{className:"payconductor",id:"payconductor",style:{display:"contents"},children:e.children})}function ee(e){const r=y.useRef(null),[t,n]=y.useState(()=>""),[a,c]=y.useState(()=>!1);return y.useEffect(()=>{const m=f=>{f!=null&&f.frame&&(n(f.frame.iframeUrl||""),f.frame.iframe=r.current,console.log("[PayConductorCheckoutElement] iframe registered, src:",t),c(!0))},h=typeof window<"u"?window.PayConductor:null;if(h)m(h);else{const f=E=>{m(E.detail),window.removeEventListener("payconductor:registered",f)};window.addEventListener("payconductor:registered",f)}},[]),L.jsx("div",{className:"payconductor-element",style:{width:"100%"},children:a&&t?L.jsx("iframe",{allow:"payment",title:"PayConductor",ref:r,src:t,style:{width:"100%",height:e.height||b,border:"none"}}):null})}function te(){const e=typeof window<"u"?window.PayConductor:null,r=e!=null&&e.config?{publicKey:e.config.publicKey,orderId:e.config.orderId,theme:e.config.theme,locale:e.config.locale}:{},t=e!=null&&e.frame?{iframe:e.frame.iframe,isReady:e.frame.isReady,error:e.frame.error}:{iframe:null,isReady:!1,error:null};return{...r,...t}}function S(e){var r;if((r=e==null?void 0:e.frame)!=null&&r.iframe){const t=e.frame.iframe;if(t instanceof HTMLIFrameElement)return t;if(t&&typeof t=="object"){if("current"in t){const n=t.current;if(n instanceof HTMLIFrameElement)return n}if("value"in t){const n=t.value;if(n instanceof HTMLIFrameElement)return n}}}return document.querySelector(".payconductor-element iframe")??null}function ne(){const e=()=>typeof window<"u"?window.PayConductor:null,r=(t,n)=>{const a=e();if(!a)return;const c=S(a);c!=null&&c.contentWindow&&c.contentWindow.postMessage({type:t,data:n},"*")};return{init:async t=>{const n=S(e()),a=C();return x(n||void 0,a,t)},confirmPayment:async t=>{const n=S(e()),a=C();if(!t.orderId)throw new Error("Order ID is required");return Y(n||void 0,a,t)},validate:t=>{const n=e();return n?n.api.validate(t):Promise.resolve(!1)},reset:()=>{const t=e();return t?t.api.reset():Promise.resolve()},getSelectedPaymentMethod:()=>{var t;return((t=e())==null?void 0:t.selectedPaymentMethod)??null},updateConfig:t=>{var a;const n=(a=e())==null?void 0:a.config;r(s.CONFIG,{publicKey:n==null?void 0:n.publicKey,orderId:n==null?void 0:n.orderId,theme:t.theme??(n==null?void 0:n.theme),locale:t.locale??(n==null?void 0:n.locale),paymentMethods:t.paymentMethods??(n==null?void 0:n.paymentMethods)})},updateorderId:t=>{var a;const n=(a=e())==null?void 0:a.config;r(s.CONFIG,{publicKey:n==null?void 0:n.publicKey,orderId:t,theme:n==null?void 0:n.theme,locale:n==null?void 0:n.locale,paymentMethods:n==null?void 0:n.paymentMethods})},update:t=>{r(s.UPDATE,t)},submit:async()=>{const t=S(e()),n=C();try{return await M(t||void 0,n,s.CONFIRM_PAYMENT,{}),{paymentMethod:void 0}}catch(a){return{error:{message:a instanceof Error?a.message:"Payment failed",code:"payment_error",type:"payment_error"}}}}}}exports.ALLOWED_ORIGINS=v;exports.ERROR_CODES=$;exports.IFRAME_BASE_URL=U;exports.IFRAME_DEFAULT_HEIGHT_VALUE=b;exports.POST_MESSAGES=s;exports.PayConductor=G;exports.PayConductorCheckoutElement=ee;exports.REQUEST_TIMEOUT=F;exports.buildIframeUrl=K;exports.default=G;exports.generateRequestId=V;exports.isValidOrigin=g;exports.usePayConductor=te;exports.usePayconductorElement=ne;
//# sourceMappingURL=index.cjs.js.map
