"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const L=require("react/jsx-runtime"),m=require("react"),D="https://iframe.payconductor.ai/v1",U="http://localhost:5175",B=3e4,W="600px";var I=(e=>(e.Init="Init",e.Config="Config",e.Update="Update",e.ConfirmPayment="ConfirmPayment",e.Validate="Validate",e.Reset="Reset",e))(I||{}),h=(e=>(e.Ready="Ready",e.Error="Error",e.PaymentComplete="PaymentComplete",e.PaymentFailed="PaymentFailed",e.PaymentPending="PaymentPending",e.ValidationError="ValidationError",e.PaymentMethodSelected="PaymentMethodSelected",e))(h||{});const Q=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"),O=Q?U:D,b=[U,D],v=W,F=B,s={INIT:I.Init,CONFIG:I.Config,UPDATE:I.Update,CONFIRM_PAYMENT:I.ConfirmPayment,VALIDATE:I.Validate,RESET:I.Reset,READY:h.Ready,ERROR:h.Error,PAYMENT_COMPLETE:h.PaymentComplete,PAYMENT_FAILED:h.PaymentFailed,PAYMENT_PENDING:h.PaymentPending,VALIDATION_ERROR:h.ValidationError,PAYMENT_METHOD_SELECTED:h.PaymentMethodSelected},$={INVALID_CLIENT:"InvalidClient",INVALID_TOKEN:"InvalidToken",NETWORK_ERROR:"NetworkError",IFRAME_NOT_READY:"IframeNotReady",PAYMENT_DECLINED:"PaymentDeclined",VALIDATION_ERROR:"ValidationError",TIMEOUT:"Timeout"};function k(e){const n=new URLSearchParams({publicKey:e.publicKey});return`${O}?${n.toString()}`}function K(){return crypto.randomUUID()}function V(e,n){return n.includes(e)}function S(){return new Map}function T(e,n,o,t){return new Promise((i,f)=>{if(!e||!("contentWindow"in e)){f(new Error("Iframe not defined"));return}if(!(e!=null&&e.contentWindow)){f(new Error("Iframe not ready"));return}if(!n){f(new Error("Pending requests not initialized"));return}const l=K();n.set(l,{resolve:i,reject:f}),e.contentWindow.postMessage({type:o,data:t,requestId:l},"*"),setTimeout(()=>{n!=null&&n.has(l)&&(n.delete(l),f(new Error("Request timeout")))},F)})}function g(e,n,o){return T(e,n,s.CONFIRM_PAYMENT,{orderId:o.orderId})}function J(e,n,o){return T(e,n,s.VALIDATE,o)}function X(e,n){return T(e,n,s.RESET)}function Z(e,n,o){return T(e,n,s.CONFIG,o)}function x(e,n,o){return T(e,n,s.INIT,o)}function p(e,n,o,t,i,f,l,C,R,E){if(!V(e.origin,b))return;const N=e.data,{requestId:w,type:P,data:u,error:y}=N;if(w&&(n!=null&&n.has(w))){const{resolve:d,reject:M}=n.get(w);n.delete(w),y?M(new Error(String(y.message))):d(u);return}if(P===s.READY){o(!0),i==null||i();return}if(P===s.ERROR){t((y==null?void 0:y.message)||"Unknown error"),f==null||f(new Error(String(y==null?void 0:y.message)));return}if(P===s.PAYMENT_COMPLETE){u&&typeof u=="object"&&"status"in u&&(l==null||l(u));return}if(P===s.PAYMENT_FAILED){u&&typeof u=="object"&&"status"in u&&(C==null||C(u));return}if(P===s.PAYMENT_PENDING){u&&typeof u=="object"&&"status"in u&&(R==null||R(u));return}if(P===s.PAYMENT_METHOD_SELECTED){u&&typeof u=="object"&&"paymentMethod"in u&&(E==null||E(u.paymentMethod));return}}function Y(e){const[n,o]=m.useState(()=>!1),[t,i]=m.useState(()=>!1),[f,l]=m.useState(()=>null),[C,R]=m.useState(()=>""),[E,N]=m.useState(()=>null),[w,P]=m.useState(()=>null),[u,y]=m.useState(()=>!1);return m.useEffect(()=>{const d=(...r)=>{e.debug&&console.log("[PayConductor]",...r)};d("SDK initializing",{publicKey:e.publicKey});const M=k({publicKey:e.publicKey});R(M),o(!0),N(S()),d("iframeUrl built:",M),d("pendingMap created");const _=()=>{var a,c;const r=(c=(a=window.PayConductor)==null?void 0:a.frame)==null?void 0:c.iframe;if(r){if(r instanceof HTMLIFrameElement)return r;if(typeof r=="object"&&r!==null){if("current"in r)return r.current??void 0;if("value"in r)return r.value??void 0}return r}},G={iframe:null,iframeUrl:M,get isReady(){return t},get error(){return f}},H={publicKey:e.publicKey,theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod},z={confirmPayment:r=>(d("confirmPayment called",{orderId:r.orderId}),g(_(),E,r)),validate:r=>(d("validate called",r),J(_(),E,r)),reset:()=>(d("reset called"),X(_(),E)),getSelectedPaymentMethod:()=>w};window.PayConductor={frame:G,config:H,api:z,selectedPaymentMethod:w},d("window.PayConductor registered");const q=async()=>{if(!u){const r=_();if(!r){d("sendConfigToIframe: iframe not found, skipping");return}y(!0),d("sendConfig →",{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons}),Z(r,E,{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons,nuPayConfig:e.nuPayConfig})}},j=r=>{p(r,E,a=>{i(a),a&&(d("iframe Ready — sending config"),q())},a=>{l(a),d("iframe Error:",a)},()=>{var a;d("onReady fired"),(a=e.onReady)==null||a.call(e)},a=>{var c;d("onError fired:",a),(c=e.onError)==null||c.call(e,a)},a=>{var c;d("PaymentComplete:",a),(c=e.onPaymentComplete)==null||c.call(e,a)},a=>{var c;d("PaymentFailed:",a),(c=e.onPaymentFailed)==null||c.call(e,a)},a=>{var c;d("PaymentPending:",a),(c=e.onPaymentPending)==null||c.call(e,a)},a=>{var c;d("PaymentMethodSelected:",a),P(a),window.PayConductor&&(window.PayConductor.selectedPaymentMethod=a),(c=e.onPaymentMethodSelected)==null||c.call(e,a)})};window.addEventListener("message",j),d("SDK initialized — waiting for PayConductorCheckoutElement")},[]),L.jsx("div",{className:"payconductor",id:"payconductor",style:{display:"contents"},children:e.children})}function ee(e){const n=m.useRef(null),[o,t]=m.useState(()=>""),[i,f]=m.useState(()=>!1);return m.useEffect(()=>{const l=typeof window<"u"?window.PayConductor:null;l||console.warn("[PayConductorCheckoutElement] window.PayConductor not found — ensure <PayConductor> is mounted before <PayConductorCheckoutElement>"),l!=null&&l.frame&&(t(l.frame.iframeUrl||""),l.frame.iframe=n.current,console.log("[PayConductorCheckoutElement] iframe registered, src:",o)),f(!0)},[]),L.jsx("div",{className:"payconductor-element",style:{width:"100%"},children:i&&o?L.jsx("iframe",{allow:"payment",title:"PayConductor",ref:n,src:o,style:{width:"100%",height:e.height||v,border:"none"}}):null})}function te(){const e=typeof window<"u"?window.PayConductor:null,n=e!=null&&e.config?{publicKey:e.config.publicKey,orderId:e.config.orderId,theme:e.config.theme,locale:e.config.locale}:{},o=e!=null&&e.frame?{iframe:e.frame.iframe,isReady:e.frame.isReady,error:e.frame.error}:{iframe:null,isReady:!1,error:null};return{...n,...o}}function A(e){var o;if(!((o=e==null?void 0:e.frame)!=null&&o.iframe))return null;const n=e.frame.iframe;if(n instanceof HTMLIFrameElement)return n;if(n&&typeof n=="object"&&"value"in n){const t=n.value;if(t instanceof HTMLIFrameElement)return t}return null}function ne(){const e=typeof window<"u"?window.PayConductor:null,n=(o,t)=>{if(!e)return;const i=A(e);i!=null&&i.contentWindow&&i.contentWindow.postMessage({type:o,data:t},"*")};return e?{init:async o=>{const t=A(e),i=S();return x(t||void 0,i,o)},confirmPayment:async o=>{const t=A(e),i=S();if(!o.orderId)throw new Error("Order ID is required");return g(t||void 0,i,o)},validate:e.api.validate,reset:e.api.reset,getSelectedPaymentMethod:()=>(e==null?void 0:e.selectedPaymentMethod)??null,updateConfig:o=>{const t=e.config;n(s.CONFIG,{publicKey:t==null?void 0:t.publicKey,orderId:t==null?void 0:t.orderId,theme:o.theme??(t==null?void 0:t.theme),locale:o.locale??(t==null?void 0:t.locale),paymentMethods:o.paymentMethods??(t==null?void 0:t.paymentMethods)})},updateorderId:o=>{const t=e.config;n(s.CONFIG,{publicKey:t==null?void 0:t.publicKey,orderId:o,theme:t==null?void 0:t.theme,locale:t==null?void 0:t.locale,paymentMethods:t==null?void 0:t.paymentMethods})},update:o=>{n(s.UPDATE,o)},submit:async()=>{const o=A(e),t=S();try{return await T(o||void 0,t,s.CONFIRM_PAYMENT,{}),{paymentMethod:void 0}}catch(i){return{error:{message:i instanceof Error?i.message:"Payment failed",code:"payment_error",type:"payment_error"}}}}}:{init:async()=>{throw new Error("PayConductor not initialized")},confirmPayment:async()=>{throw new Error("PayConductor not initialized")},validate:async()=>{throw new Error("PayConductor not initialized")},reset:async()=>{throw new Error("PayConductor not initialized")},getSelectedPaymentMethod:()=>null,updateConfig:()=>{throw new Error("PayConductor not initialized")},updateorderId:()=>{throw new Error("PayConductor not initialized")},update:()=>{throw new Error("PayConductor not initialized")},submit:async()=>{throw new Error("PayConductor not initialized")}}}exports.ALLOWED_ORIGINS=b;exports.ERROR_CODES=$;exports.IFRAME_BASE_URL=O;exports.IFRAME_DEFAULT_HEIGHT_VALUE=v;exports.POST_MESSAGES=s;exports.PayConductor=Y;exports.PayConductorCheckoutElement=ee;exports.REQUEST_TIMEOUT=F;exports.buildIframeUrl=k;exports.default=Y;exports.generateRequestId=K;exports.isValidOrigin=V;exports.usePayConductor=te;exports.usePayconductorElement=ne;
//# sourceMappingURL=index.cjs.js.map
