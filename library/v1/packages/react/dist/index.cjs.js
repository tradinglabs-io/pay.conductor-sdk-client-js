"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const O=require("react/jsx-runtime"),I=require("react"),D="https://iframe.payconductor.ai/v1",v="http://localhost:5175/v1",g=3e4,Q="600px";var T=(e=>(e.Init="Init",e.Config="Config",e.Update="Update",e.ConfirmPayment="ConfirmPayment",e.Validate="Validate",e.Reset="Reset",e))(T||{}),w=(e=>(e.Ready="Ready",e.Error="Error",e.PaymentComplete="PaymentComplete",e.PaymentFailed="PaymentFailed",e.PaymentPending="PaymentPending",e.ValidationError="ValidationError",e.PaymentMethodSelected="PaymentMethodSelected",e))(w||{});const $=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&!window.location.search.includes("production"),b=($?v:D)+"?"+window.location.search,F=[v,D],V=Q,Y=g,s={INIT:T.Init,CONFIG:T.Config,UPDATE:T.Update,CONFIRM_PAYMENT:T.ConfirmPayment,VALIDATE:T.Validate,RESET:T.Reset,READY:w.Ready,ERROR:w.Error,PAYMENT_COMPLETE:w.PaymentComplete,PAYMENT_FAILED:w.PaymentFailed,PAYMENT_PENDING:w.PaymentPending,VALIDATION_ERROR:w.ValidationError,PAYMENT_METHOD_SELECTED:w.PaymentMethodSelected},z={INVALID_CLIENT:"InvalidClient",INVALID_TOKEN:"InvalidToken",NETWORK_ERROR:"NetworkError",IFRAME_NOT_READY:"IframeNotReady",PAYMENT_DECLINED:"PaymentDeclined",VALIDATION_ERROR:"ValidationError",TIMEOUT:"Timeout"};function G(e){const r=new URLSearchParams({publicKey:e.publicKey});return`${b}?${r.toString()}`}function K(){return crypto.randomUUID()}function q(e,r){return r.some(t=>{try{return new URL(t).origin===e}catch{return t===e}})}function S(){return new Map}function M(e,r,t,n){return new Promise((i,u)=>{if(!e||!("contentWindow"in e)){u(new Error("Iframe not defined"));return}if(!(e!=null&&e.contentWindow)){u(new Error("Iframe not ready"));return}if(!r){u(new Error("Pending requests not initialized"));return}const f=K();r.set(f,{resolve:i,reject:u}),e.contentWindow.postMessage({type:t,data:n,requestId:f},"*"),setTimeout(()=>{r!=null&&r.has(f)&&(r.delete(f),u(new Error("Request timeout")))},Y)})}function H(e,r,t){return M(e,r,s.CONFIRM_PAYMENT,{orderId:t.orderId})}function J(e,r,t){return M(e,r,s.VALIDATE,t)}function X(e,r){return M(e,r,s.RESET)}function Z(e,r,t){return M(e,r,s.CONFIG,t)}function x(e,r,t){return M(e,r,s.INIT,t)}function p(e,r,t,n,i,u,f,R,m,P){if(!q(e.origin,F))return;const N=e.data,{requestId:l,type:E,data:d,error:y}=N;if(l&&(r!=null&&r.has(l))){const{resolve:h,reject:_}=r.get(l);r.delete(l),y?_(new Error(String(y.message))):h(d);return}if(E===s.READY){t(!0),i==null||i();return}if(E===s.ERROR){n((y==null?void 0:y.message)||"Unknown error"),u==null||u(new Error(String(y==null?void 0:y.message)));return}if(E===s.PAYMENT_COMPLETE){d&&typeof d=="object"&&"status"in d&&(f==null||f(d));return}if(E===s.PAYMENT_FAILED){d&&typeof d=="object"&&"status"in d&&(R==null||R(d));return}if(E===s.PAYMENT_PENDING){d&&typeof d=="object"&&"status"in d&&(m==null||m(d));return}if(E===s.PAYMENT_METHOD_SELECTED){d&&typeof d=="object"&&"paymentMethod"in d&&(P==null||P(d.paymentMethod));return}}function j(e){const[r,t]=I.useState(()=>!1),[n,i]=I.useState(()=>!1),[u,f]=I.useState(()=>null),[R,m]=I.useState(()=>""),[P,N]=I.useState(()=>null);return I.useEffect(()=>{const l=(...o)=>{e.debug&&console.log("[PayConductor]",...o)},E=G({publicKey:e.publicKey});m(E),t(!0);const d=S();let y=!1;l("init",e.publicKey),l("iframeUrl",E);const h=()=>{var A,a;const o=(a=(A=window.PayConductor)==null?void 0:A.frame)==null?void 0:a.iframe;if(o){if(o instanceof HTMLIFrameElement)return o;if(typeof o=="object"&&o!==null){if("current"in o)return o.current??void 0;if("value"in o)return o.value??void 0}return o}return document.querySelector(".payconductor-element iframe")??void 0},_={get iframe(){return document.querySelector(".payconductor-element iframe")??null},set iframe(o){},iframeUrl:E,isReady:!1,error:null},B={publicKey:e.publicKey,theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod},W={confirmPayment:o=>(l("→ CONFIRM_PAYMENT",{orderId:o.orderId}),H(h(),d,o)),validate:o=>(l("→ VALIDATE",o),J(h(),d,o)),reset:()=>(l("→ RESET"),X(h(),d)),getSelectedPaymentMethod:()=>P};window.PayConductor={frame:_,config:B,api:W,selectedPaymentMethod:P},l("registered"),window.dispatchEvent(new CustomEvent("payconductor:registered",{detail:window.PayConductor}));const C=async()=>{if(!y){const o=h();if(!o){l("→ CONFIG skipped: iframe not found");return}y=!0,l("→ CONFIG",{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons}),Z(o,d,{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons,nuPayConfig:e.nuPayConfig})}},k=o=>{var A;(A=o.data)!=null&&A.type&&l("←",o.data.type,o.data.data??""),p(o,d,a=>{var c;i(a),_.isReady=a,(c=window.PayConductor)!=null&&c.frame&&(window.PayConductor.frame.isReady=a),a&&C()},a=>{var c;f(a),_.error=a,(c=window.PayConductor)!=null&&c.frame&&(window.PayConductor.frame.error=a)},()=>{var a;(a=e.onReady)==null||a.call(e)},a=>{var c;(c=e.onError)==null||c.call(e,a)},a=>{var c;(c=e.onPaymentComplete)==null||c.call(e,a)},a=>{var c;(c=e.onPaymentFailed)==null||c.call(e,a)},a=>{var c;(c=e.onPaymentPending)==null||c.call(e,a)},a=>{var c;N(a),window.PayConductor&&(window.PayConductor.selectedPaymentMethod=a),(c=e.onPaymentMethodSelected)==null||c.call(e,a)})};window.addEventListener("message",k);const U=()=>{const o=h();return o?(o.addEventListener("load",()=>C(),{once:!0}),!0):!1};if(!U()){const o=new MutationObserver(()=>{U()&&o.disconnect()});o.observe(document.body,{childList:!0,subtree:!0})}},[]),O.jsx("div",{className:"payconductor",id:"payconductor",style:{display:"contents"},children:e.children})}function ee(e){const r=I.useRef(null),[t,n]=I.useState(()=>""),[i,u]=I.useState(()=>!1);return I.useEffect(()=>{const f=m=>{m!=null&&m.frame&&(n(m.frame.iframeUrl||""),u(!0))},R=typeof window<"u"?window.PayConductor:null;if(R)f(R);else{const m=P=>{f(P.detail),window.removeEventListener("payconductor:registered",m)};window.addEventListener("payconductor:registered",m)}},[]),O.jsx("div",{className:"payconductor-element",style:{width:"100%"},children:i&&t?O.jsx("iframe",{allow:"payment",title:"PayConductor",ref:r,src:t,style:{width:"100%",height:e.height||V,border:"none"}}):null})}function te(){const e=typeof window<"u"?window.PayConductor:null,r=e!=null&&e.config?{publicKey:e.config.publicKey,orderId:e.config.orderId,theme:e.config.theme,locale:e.config.locale}:{},t=e!=null&&e.frame?{iframe:e.frame.iframe,isReady:e.frame.isReady,error:e.frame.error}:{iframe:null,isReady:!1,error:null};return{...r,...t}}function L(e){var r;if((r=e==null?void 0:e.frame)!=null&&r.iframe){const t=e.frame.iframe;if(t instanceof HTMLIFrameElement)return t;if(t&&typeof t=="object"){if("current"in t){const n=t.current;if(n instanceof HTMLIFrameElement)return n}if("value"in t){const n=t.value;if(n instanceof HTMLIFrameElement)return n}}}return document.querySelector(".payconductor-element iframe")??null}function ne(){const e=()=>typeof window<"u"?window.PayConductor:null,r=(t,n)=>{const i=e();if(!i)return;const u=L(i);u!=null&&u.contentWindow&&u.contentWindow.postMessage({type:t,data:n},"*")};return{init:async t=>{const n=L(e()),i=S();return x(n||void 0,i,t)},confirmPayment:async t=>{const n=L(e()),i=S();if(!t.orderId)throw new Error("Order ID is required");return H(n||void 0,i,t)},validate:t=>{const n=e();return n?n.api.validate(t):Promise.resolve(!1)},reset:()=>{const t=e();return t?t.api.reset():Promise.resolve()},getSelectedPaymentMethod:()=>{var t;return((t=e())==null?void 0:t.selectedPaymentMethod)??null},updateConfig:t=>{var i;const n=(i=e())==null?void 0:i.config;r(s.CONFIG,{publicKey:n==null?void 0:n.publicKey,orderId:n==null?void 0:n.orderId,theme:t.theme??(n==null?void 0:n.theme),locale:t.locale??(n==null?void 0:n.locale),paymentMethods:t.paymentMethods??(n==null?void 0:n.paymentMethods)})},updateorderId:t=>{var i;const n=(i=e())==null?void 0:i.config;r(s.CONFIG,{publicKey:n==null?void 0:n.publicKey,orderId:t,theme:n==null?void 0:n.theme,locale:n==null?void 0:n.locale,paymentMethods:n==null?void 0:n.paymentMethods})},update:t=>{r(s.UPDATE,t)},submit:async()=>{const t=L(e()),n=S();try{return await M(t||void 0,n,s.CONFIRM_PAYMENT,{}),{paymentMethod:void 0}}catch(i){return{error:{message:i instanceof Error?i.message:"Payment failed",code:"payment_error",type:"payment_error"}}}}}}exports.ALLOWED_ORIGINS=F;exports.ERROR_CODES=z;exports.IFRAME_BASE_URL=b;exports.IFRAME_DEFAULT_HEIGHT_VALUE=V;exports.POST_MESSAGES=s;exports.PayConductor=j;exports.PayConductorCheckoutElement=ee;exports.REQUEST_TIMEOUT=Y;exports.buildIframeUrl=G;exports.default=j;exports.generateRequestId=K;exports.isValidOrigin=q;exports.usePayConductor=te;exports.usePayconductorElement=ne;
//# sourceMappingURL=index.cjs.js.map
