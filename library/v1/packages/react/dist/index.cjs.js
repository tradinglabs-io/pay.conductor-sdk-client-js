"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const C=require("react/jsx-runtime"),I=require("react"),O="https://iframe.payconductor.ai/v1",U="http://localhost:5175/v1",k=3e4,Q="600px";var h=(e=>(e.Init="Init",e.Config="Config",e.Update="Update",e.ConfirmPayment="ConfirmPayment",e.Validate="Validate",e.Reset="Reset",e))(h||{}),w=(e=>(e.Ready="Ready",e.Error="Error",e.PaymentComplete="PaymentComplete",e.PaymentFailed="PaymentFailed",e.PaymentPending="PaymentPending",e.ValidationError="ValidationError",e.PaymentMethodSelected="PaymentMethodSelected",e))(w||{});const g=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&!window.location.search.includes("production"),D=g?U:O,v=[U,O],F=Q,b=k,l={INIT:h.Init,CONFIG:h.Config,UPDATE:h.Update,CONFIRM_PAYMENT:h.ConfirmPayment,VALIDATE:h.Validate,RESET:h.Reset,READY:w.Ready,ERROR:w.Error,PAYMENT_COMPLETE:w.PaymentComplete,PAYMENT_FAILED:w.PaymentFailed,PAYMENT_PENDING:w.PaymentPending,VALIDATION_ERROR:w.ValidationError,PAYMENT_METHOD_SELECTED:w.PaymentMethodSelected},$={INVALID_CLIENT:"InvalidClient",INVALID_TOKEN:"InvalidToken",NETWORK_ERROR:"NetworkError",IFRAME_NOT_READY:"IframeNotReady",PAYMENT_DECLINED:"PaymentDeclined",VALIDATION_ERROR:"ValidationError",TIMEOUT:"Timeout"};function V(e){const r=new URLSearchParams({publicKey:e.publicKey});return`${D}?${r.toString()}`}function Y(){return crypto.randomUUID()}function G(e,r){return r.some(t=>{try{return new URL(t).origin===e}catch{return t===e}})}function S(){return new Map}function M(e,r,t,n){return new Promise((i,c)=>{if(!e||!("contentWindow"in e)){c(new Error("Iframe not defined"));return}if(!(e!=null&&e.contentWindow)){c(new Error("Iframe not ready"));return}if(!r){c(new Error("Pending requests not initialized"));return}const m=Y();r.set(m,{resolve:i,reject:c}),e.contentWindow.postMessage({type:t,data:n,requestId:m},"*"),setTimeout(()=>{r!=null&&r.has(m)&&(r.delete(m),c(new Error("Request timeout")))},b)})}function K(e,r,t){return M(e,r,l.CONFIRM_PAYMENT,{orderId:t.orderId})}function z(e,r,t){return M(e,r,l.VALIDATE,t)}function J(e,r){return M(e,r,l.RESET)}function X(e,r,t){return M(e,r,l.CONFIG,t)}function Z(e,r,t){return M(e,r,l.INIT,t)}function x(e,r,t,n,i,c,m,R,s,P){if(!G(e.origin,v))return;const L=e.data,{requestId:f,type:E,data:d,error:y}=L;if(f&&(r!=null&&r.has(f))){const{resolve:T,reject:_}=r.get(f);r.delete(f),y?_(new Error(String(y.message))):T(d);return}if(E===l.READY){t(!0),i==null||i();return}if(E===l.ERROR){n((y==null?void 0:y.message)||"Unknown error"),c==null||c(new Error(String(y==null?void 0:y.message)));return}if(E===l.PAYMENT_COMPLETE){d&&typeof d=="object"&&"status"in d&&(m==null||m(d));return}if(E===l.PAYMENT_FAILED){d&&typeof d=="object"&&"status"in d&&(R==null||R(d));return}if(E===l.PAYMENT_PENDING){d&&typeof d=="object"&&"status"in d&&(s==null||s(d));return}if(E===l.PAYMENT_METHOD_SELECTED){d&&typeof d=="object"&&"paymentMethod"in d&&(P==null||P(d.paymentMethod));return}}function H(e){const[r,t]=I.useState(()=>!1),[n,i]=I.useState(()=>!1),[c,m]=I.useState(()=>null),[R,s]=I.useState(()=>""),[P,L]=I.useState(()=>null);return I.useEffect(()=>{const f=(...o)=>{e.debug&&console.log("[PayConductor]",...o)},E=V({publicKey:e.publicKey});s(E),t(!0);const d=S();let y=!1;f("init",e.publicKey),f("iframeUrl",E);const T=()=>{var A,a;const o=(a=(A=window.PayConductor)==null?void 0:A.frame)==null?void 0:a.iframe;if(o){if(o instanceof HTMLIFrameElement)return o;if(typeof o=="object"&&o!==null){if("current"in o)return o.current??void 0;if("value"in o)return o.value??void 0}return o}return document.querySelector(".payconductor-element iframe")??void 0},_={iframe:null,iframeUrl:E,isReady:!1,error:null},q={publicKey:e.publicKey,theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod},j={confirmPayment:o=>(f("→ CONFIRM_PAYMENT",{orderId:o.orderId}),K(T(),d,o)),validate:o=>(f("→ VALIDATE",o),z(T(),d,o)),reset:()=>(f("→ RESET"),J(T(),d)),getSelectedPaymentMethod:()=>P};window.PayConductor={frame:_,config:q,api:j,selectedPaymentMethod:P},f("registered"),window.dispatchEvent(new CustomEvent("payconductor:registered",{detail:window.PayConductor}));const B=async()=>{if(!y){const o=T();if(!o){f("→ CONFIG skipped: iframe not found");return}y=!0,f("→ CONFIG",{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons}),X(o,d,{theme:e.theme,locale:e.locale,paymentMethods:e.paymentMethods,defaultPaymentMethod:e.defaultPaymentMethod,showPaymentButtons:e.showPaymentButtons,nuPayConfig:e.nuPayConfig})}},W=o=>{var A;(A=o.data)!=null&&A.type&&f("←",o.data.type,o.data.data??""),x(o,d,a=>{var u;i(a),_.isReady=a,(u=window.PayConductor)!=null&&u.frame&&(window.PayConductor.frame.isReady=a),a&&B()},a=>{var u;m(a),_.error=a,(u=window.PayConductor)!=null&&u.frame&&(window.PayConductor.frame.error=a)},()=>{var a;(a=e.onReady)==null||a.call(e)},a=>{var u;(u=e.onError)==null||u.call(e,a)},a=>{var u;(u=e.onPaymentComplete)==null||u.call(e,a)},a=>{var u;(u=e.onPaymentFailed)==null||u.call(e,a)},a=>{var u;(u=e.onPaymentPending)==null||u.call(e,a)},a=>{var u;L(a),window.PayConductor&&(window.PayConductor.selectedPaymentMethod=a),(u=e.onPaymentMethodSelected)==null||u.call(e,a)})};window.addEventListener("message",W)},[]),C.jsx("div",{className:"payconductor",id:"payconductor",style:{display:"contents"},children:e.children})}function p(e){const r=I.useRef(null),[t,n]=I.useState(()=>""),[i,c]=I.useState(()=>!1);return I.useEffect(()=>{const m=s=>{s!=null&&s.frame&&(n(s.frame.iframeUrl||""),s.frame.iframe=r.current,c(!0))},R=typeof window<"u"?window.PayConductor:null;if(R)m(R);else{const s=P=>{m(P.detail),window.removeEventListener("payconductor:registered",s)};window.addEventListener("payconductor:registered",s)}},[]),C.jsx("div",{className:"payconductor-element",style:{width:"100%"},children:i&&t?C.jsx("iframe",{allow:"payment",title:"PayConductor",ref:r,src:t,style:{width:"100%",height:e.height||F,border:"none"}}):null})}function ee(){const e=typeof window<"u"?window.PayConductor:null,r=e!=null&&e.config?{publicKey:e.config.publicKey,orderId:e.config.orderId,theme:e.config.theme,locale:e.config.locale}:{},t=e!=null&&e.frame?{iframe:e.frame.iframe,isReady:e.frame.isReady,error:e.frame.error}:{iframe:null,isReady:!1,error:null};return{...r,...t}}function N(e){var r;if((r=e==null?void 0:e.frame)!=null&&r.iframe){const t=e.frame.iframe;if(t instanceof HTMLIFrameElement)return t;if(t&&typeof t=="object"){if("current"in t){const n=t.current;if(n instanceof HTMLIFrameElement)return n}if("value"in t){const n=t.value;if(n instanceof HTMLIFrameElement)return n}}}return document.querySelector(".payconductor-element iframe")??null}function te(){const e=()=>typeof window<"u"?window.PayConductor:null,r=(t,n)=>{const i=e();if(!i)return;const c=N(i);c!=null&&c.contentWindow&&c.contentWindow.postMessage({type:t,data:n},"*")};return{init:async t=>{const n=N(e()),i=S();return Z(n||void 0,i,t)},confirmPayment:async t=>{const n=N(e()),i=S();if(!t.orderId)throw new Error("Order ID is required");return K(n||void 0,i,t)},validate:t=>{const n=e();return n?n.api.validate(t):Promise.resolve(!1)},reset:()=>{const t=e();return t?t.api.reset():Promise.resolve()},getSelectedPaymentMethod:()=>{var t;return((t=e())==null?void 0:t.selectedPaymentMethod)??null},updateConfig:t=>{var i;const n=(i=e())==null?void 0:i.config;r(l.CONFIG,{publicKey:n==null?void 0:n.publicKey,orderId:n==null?void 0:n.orderId,theme:t.theme??(n==null?void 0:n.theme),locale:t.locale??(n==null?void 0:n.locale),paymentMethods:t.paymentMethods??(n==null?void 0:n.paymentMethods)})},updateorderId:t=>{var i;const n=(i=e())==null?void 0:i.config;r(l.CONFIG,{publicKey:n==null?void 0:n.publicKey,orderId:t,theme:n==null?void 0:n.theme,locale:n==null?void 0:n.locale,paymentMethods:n==null?void 0:n.paymentMethods})},update:t=>{r(l.UPDATE,t)},submit:async()=>{const t=N(e()),n=S();try{return await M(t||void 0,n,l.CONFIRM_PAYMENT,{}),{paymentMethod:void 0}}catch(i){return{error:{message:i instanceof Error?i.message:"Payment failed",code:"payment_error",type:"payment_error"}}}}}}exports.ALLOWED_ORIGINS=v;exports.ERROR_CODES=$;exports.IFRAME_BASE_URL=D;exports.IFRAME_DEFAULT_HEIGHT_VALUE=F;exports.POST_MESSAGES=l;exports.PayConductor=H;exports.PayConductorCheckoutElement=p;exports.REQUEST_TIMEOUT=b;exports.buildIframeUrl=V;exports.default=H;exports.generateRequestId=Y;exports.isValidOrigin=G;exports.usePayConductor=ee;exports.usePayconductorElement=te;
//# sourceMappingURL=index.cjs.js.map
