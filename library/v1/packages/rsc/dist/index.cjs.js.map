{"version":3,"file":"index.cjs.js","sources":["../src/payconductor/iframe/constants.ts","../src/payconductor/iframe/types.ts","../src/payconductor/constants.ts","../src/payconductor/utils.ts","../src/payconductor/internal.ts","../src/payconductor/payconductor.tsx","../src/payconductor/hooks/use-payconductor.ts","../src/payconductor/hooks/use-element.ts"],"sourcesContent":["// PayConductor Shared Constants\n// Served statically at iframe.payconductor.ai/constants.ts\n// Used by the iFrame (imported directly) and the SDK Web (synced with: bun sync)\n\nexport const APP_BASE_URL_PROD = \"https://app.payconductor.ai\";\nexport const API_BASE_URL_PROD = \"https://app.payconductor.ai/api/v1\";\nexport const IFRAME_BASE_URL_PROD = \"https://iframe.payconductor.ai\";\nexport const IFRAME_BASE_URL_DEV = \"http://localhost:5175\";\nexport const APP_BASE_URL_DEV = \"http://localhost:3000\";\nexport const DEFAULT_LOCALE = \"pt-BR\";\nexport const REQUEST_TIMEOUT_MS = 30000;\nexport const IFRAME_DEFAULT_HEIGHT = \"600px\"","// PayConductor Shared Types\n// Served statically at iframe.payconductor.ai/types.ts\n// Used by the iFrame (imported directly) and the SDK Web (synced with: bun sync)\n\nexport enum PaymentMethod {\n  Pix = \"Pix\",\n  CreditCard = \"CreditCard\",\n  DebitCard = \"DebitCard\",\n  BankSlip = \"BankSlip\",\n  Crypto = \"Crypto\",\n  ApplePay = \"ApplePay\",\n  NuPay = \"NuPay\",\n  PicPay = \"PicPay\",\n  AmazonPay = \"AmazonPay\",\n  SepaDebit = \"SepaDebit\",\n  GooglePay = \"GooglePay\",\n}\nexport enum PaymentMethodLayout {\n  Grid = \"grid\",\n  Vertical = \"vertical\",\n  Horizontal = \"horizontal\",\n}\nexport enum PaymentStatus {\n  Succeeded = \"succeeded\",\n  Pending = \"pending\",\n  Failed = \"failed\",\n}\nexport enum DeviceType {\n  Android = \"android\",\n  IOS = \"ios\",\n  Web = \"web\",\n}\nexport enum InputStyleKey {\n  Padding = \"padding\",\n  Radius = \"radius\",\n  Color = \"color\",\n  Background = \"background\",\n  Shadow = \"shadow\",\n}\nexport enum OutgoingMessage {\n  Init = \"Init\",\n  Config = \"Config\",\n  Update = \"Update\",\n  ConfirmPayment = \"ConfirmPayment\",\n  Validate = \"Validate\",\n  Reset = \"Reset\",\n}\nexport enum IncomingMessage {\n  Ready = \"Ready\",\n  Error = \"Error\",\n  PaymentComplete = \"PaymentComplete\",\n  PaymentFailed = \"PaymentFailed\",\n  PaymentPending = \"PaymentPending\",\n  ValidationError = \"ValidationError\",\n  PaymentMethodSelected = \"PaymentMethodSelected\",\n}\nexport enum ErrorCode {\n  InvalidClient = \"InvalidClient\",\n  InvalidToken = \"InvalidToken\",\n  NetworkError = \"NetworkError\",\n  IframeNotReady = \"IframeNotReady\",\n  PaymentDeclined = \"PaymentDeclined\",\n  ValidationError = \"ValidationError\",\n  Timeout = \"Timeout\",\n}\nexport type InputStyleConfig = {\n  padding?: string;\n  radius?: string;\n  color?: string;\n  background?: string;\n  shadow?: string;\n};\nexport type PaymentMethodsConfig = {\n  layout?: PaymentMethodLayout;\n  gap?: string;\n  inputStyle?: InputStyleConfig;\n};\nexport type PaymentMethodConfig = {\n  method: PaymentMethod;\n  discount?: number;\n  showBrands?: boolean;\n  installments?: {\n    count: number;\n    amount: number;\n  }[];\n};\nexport type PaymentMethodsResponse = {\n  methods: PaymentMethod[];\n  config: PaymentMethodsConfig;\n};\nexport type PayConductorTheme = {\n  primaryColor?: string;\n  secondaryColor?: string;\n  backgroundColor?: string;\n  surfaceColor?: string;\n  textColor?: string;\n  textSecondaryColor?: string;\n  errorColor?: string;\n  successColor?: string;\n  warningColor?: string;\n  borderColor?: string;\n  disabledColor?: string;\n  fontFamily?: string;\n  fontSize?: {\n    xs?: string;\n    sm?: string;\n    md?: string;\n    lg?: string;\n    xl?: string;\n  };\n  fontWeight?: {\n    normal?: number;\n    medium?: number;\n    bold?: number;\n  };\n  lineHeight?: string;\n  spacing?: {\n    xs?: string;\n    sm?: string;\n    md?: string;\n    lg?: string;\n    xl?: string;\n  };\n  borderRadius?: string;\n  borderWidth?: string;\n  boxShadow?: string;\n  boxShadowHover?: string;\n  inputBackground?: string;\n  inputBorderColor?: string;\n  inputBorderRadius?: string;\n  inputHeight?: string;\n  inputPadding?: string;\n  buttonHeight?: string;\n  buttonPadding?: string;\n  buttonBorderRadius?: string;\n  transitionDuration?: string;\n  transitionTimingFunction?: string;\n};\nexport const defaultTheme: PayConductorTheme = {\n  primaryColor: \"#0066ff\",\n  secondaryColor: \"#5a6b7c\",\n  backgroundColor: \"transparent\",\n  surfaceColor: \"#f8fafc\",\n  textColor: \"#0f172a\",\n  textSecondaryColor: \"#64748b\",\n  errorColor: \"#ef4444\",\n  successColor: \"#22c55e\",\n  warningColor: \"#f59e0b\",\n  borderColor: \"#e2e8f0\",\n  disabledColor: \"#cbd5e1\",\n  fontFamily: '\"Poppins\", -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif',\n  fontSize: {\n    xs: \"0.75rem\",\n    sm: \"0.875rem\",\n    md: \"1rem\",\n    lg: \"1.125rem\",\n    xl: \"1.25rem\"\n  },\n  fontWeight: {\n    normal: 400,\n    medium: 500,\n    bold: 600\n  },\n  lineHeight: \"1.5\",\n  spacing: {\n    xs: \"4px\",\n    sm: \"8px\",\n    md: \"16px\",\n    lg: \"24px\",\n    xl: \"32px\"\n  },\n  borderRadius: \"8px\",\n  borderWidth: \"1px\",\n  boxShadow: \"0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)\",\n  boxShadowHover: \"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)\",\n  inputBackground: \"#ffffff\",\n  inputBorderColor: \"#cbd5e1\",\n  inputBorderRadius: \"8px\",\n  inputHeight: \"44px\",\n  inputPadding: \"12px 16px\",\n  buttonHeight: \"48px\",\n  buttonPadding: \"16px 24px\",\n  buttonBorderRadius: \"8px\",\n  transitionDuration: \"0.2s\",\n  transitionTimingFunction: \"ease\"\n};\nexport type PayConductorConfig = {\n  publicKey: string;\n  intentToken?: string;\n  theme?: PayConductorTheme;\n  locale?: string;\n  paymentMethods?: PaymentMethod[] | \"all\";\n  defaultPaymentMethod?: PaymentMethod;\n  paymentMethodsConfig?: PaymentMethodConfig[];\n  methodsDirection?: \"vertical\" | \"horizontal\";\n  showPaymentButtons?: boolean;\n  /** Required when NuPay is an available payment method */\n  nuPayConfig?: NuPayData;\n};\nexport type BillingDetails = {\n  name: string;\n  email?: string;\n  phone?: string;\n  address?: {\n    line1: string;\n    line2?: string;\n    city: string;\n    state: string;\n    postalCode: string;\n    country: string;\n  };\n};\nexport type CardData = {\n  number: string;\n  expMonth: string;\n  expYear: string;\n  cvc: string;\n};\nexport type CreatePaymentMethodOptions = {\n  billingDetails: BillingDetails;\n  card?: CardData;\n};\nexport type PaymentMethodResult = {\n  id: string;\n  type: PaymentMethod;\n  card?: {\n    brand: string;\n    last4: string;\n    expMonth: number;\n    expYear: number;\n  };\n  billingDetails?: BillingDetails;\n};\nexport type PaymentResult = {\n  paymentIntentId: string;\n  status: PaymentStatus;\n  amount: number;\n  currency: string;\n  message?: string;\n};\nexport interface MessagePayload {\n  type: OutgoingMessage | IncomingMessage;\n  data?: unknown;\n  requestId?: string;\n  error?: {\n    code: string;\n    message: string;\n    field?: string;\n  };\n}\nexport type CardTokenData = {\n  token: string;\n  firstSixCardNumber?: string;\n};\nexport type CardFullData = {\n  number: string;\n  holderName: string;\n  cvv: string;\n  expiration: {\n    month: number;\n    year: number;\n  };\n};\nexport type CardPaymentData = CardTokenData | CardFullData;\nexport type PixPaymentData = {\n  paymentMethod: PaymentMethod.Pix;\n  expirationInSeconds?: number;\n};\nexport type CreditCardPaymentData = {\n  paymentMethod: PaymentMethod.CreditCard;\n  card: CardPaymentData;\n  installments: number;\n  softDescriptor?: string;\n};\nexport type BankSlipPaymentData = {\n  paymentMethod: PaymentMethod.BankSlip;\n  expirationInDays?: number;\n};\nexport type NuPayData = {\n  cancelUrl: string;\n  merchantName: string;\n  returnUrl: string;\n  storeName?: string;\n};\nexport type NuPayPaymentData = {\n  paymentMethod: PaymentMethod.NuPay;\n  nuPay: NuPayData;\n};\nexport type PicPayPaymentData = {\n  paymentMethod: PaymentMethod.PicPay;\n};\nexport type PaymentConfirmData = PixPaymentData | CreditCardPaymentData | BankSlipPaymentData | NuPayPaymentData | PicPayPaymentData","import { IFRAME_BASE_URL_DEV, IFRAME_BASE_URL_PROD, IFRAME_DEFAULT_HEIGHT, REQUEST_TIMEOUT_MS } from \"./iframe/constants\";\nimport { IncomingMessage, OutgoingMessage } from \"./iframe/types\";\nconst isDev = typeof window !== \"undefined\" && (window.location.hostname === \"localhost\" || window.location.hostname === \"127.0.0.1\" || window.location.port === \"5175\");\nexport const IFRAME_BASE_URL = isDev ? IFRAME_BASE_URL_DEV : IFRAME_BASE_URL_PROD;\nexport const ALLOWED_ORIGINS = [IFRAME_BASE_URL_DEV, IFRAME_BASE_URL_PROD];\nexport const IFRAME_DEFAULT_HEIGHT_VALUE = IFRAME_DEFAULT_HEIGHT;\nexport const REQUEST_TIMEOUT = REQUEST_TIMEOUT_MS;\nexport const POST_MESSAGES = {\n  INIT: OutgoingMessage.Init,\n  CONFIG: OutgoingMessage.Config,\n  UPDATE: OutgoingMessage.Update,\n  CONFIRM_PAYMENT: OutgoingMessage.ConfirmPayment,\n  VALIDATE: OutgoingMessage.Validate,\n  RESET: OutgoingMessage.Reset,\n  READY: IncomingMessage.Ready,\n  ERROR: IncomingMessage.Error,\n  PAYMENT_COMPLETE: IncomingMessage.PaymentComplete,\n  PAYMENT_FAILED: IncomingMessage.PaymentFailed,\n  PAYMENT_PENDING: IncomingMessage.PaymentPending,\n  VALIDATION_ERROR: IncomingMessage.ValidationError,\n  PAYMENT_METHOD_SELECTED: IncomingMessage.PaymentMethodSelected\n} as const;\nexport const ERROR_CODES = {\n  INVALID_CLIENT: \"InvalidClient\",\n  INVALID_TOKEN: \"InvalidToken\",\n  NETWORK_ERROR: \"NetworkError\",\n  IFRAME_NOT_READY: \"IframeNotReady\",\n  PAYMENT_DECLINED: \"PaymentDeclined\",\n  VALIDATION_ERROR: \"ValidationError\",\n  TIMEOUT: \"Timeout\"\n} as const","import { IFRAME_BASE_URL } from \"./constants\";\nimport type { PayConductorConfig } from \"./iframe/types\";\nexport function buildIframeUrl(config: PayConductorConfig): string {\n  const params = new URLSearchParams({\n    publicKey: config.publicKey\n  });\n  return `${IFRAME_BASE_URL}?${params.toString()}`;\n}\nexport function generateRequestId(): string {\n  return crypto.randomUUID();\n}\nexport function isValidOrigin(origin: string, allowedOrigins: string[]): boolean {\n  return allowedOrigins.includes(origin);\n}","import { ALLOWED_ORIGINS, POST_MESSAGES, REQUEST_TIMEOUT } from \"./constants\";\nimport { IncomingMessage, OutgoingMessage, PayConductorConfig, PaymentMethod, PaymentResult } from \"./iframe/types\";\nimport type { ConfirmPaymentOptions, PendingRequest } from \"./types\";\nimport { generateRequestId, isValidOrigin } from \"./utils\";\nexport function createPendingRequestsMap(): Map<string, PendingRequest> {\n  return new Map<string, PendingRequest>();\n}\nexport function sendMessageToIframe(iframe: HTMLIFrameElement | Element | undefined, pendingMap: Map<string, PendingRequest> | null, type: OutgoingMessage | IncomingMessage, data?: unknown): Promise<unknown> {\n  return new Promise((resolve, reject) => {\n    if (!iframe || !(\"contentWindow\" in iframe)) {\n      reject(new Error(\"Iframe not defined\"));\n      return;\n    }\n    if (!iframe?.contentWindow) {\n      reject(new Error(\"Iframe not ready\"));\n      return;\n    }\n    if (!pendingMap) {\n      reject(new Error(\"Pending requests not initialized\"));\n      return;\n    }\n    const requestId = generateRequestId();\n    pendingMap.set(requestId, {\n      resolve,\n      reject\n    });\n    iframe.contentWindow.postMessage({\n      type,\n      data,\n      requestId\n    }, \"*\");\n    setTimeout(() => {\n      if (pendingMap?.has(requestId)) {\n        pendingMap.delete(requestId);\n        reject(new Error(\"Request timeout\"));\n      }\n    }, REQUEST_TIMEOUT);\n  });\n}\nexport function confirmPayment(iframe: HTMLIFrameElement | Element | undefined, pendingMap: Map<string, PendingRequest> | null, options: ConfirmPaymentOptions): Promise<PaymentResult> {\n  return sendMessageToIframe(iframe, pendingMap, POST_MESSAGES.CONFIRM_PAYMENT, {\n    intentToken: options.intentToken\n  }) as Promise<PaymentResult>;\n}\nexport function validatePayment(iframe: HTMLIFrameElement | Element | undefined, pendingMap: Map<string, PendingRequest> | null, data: unknown): Promise<boolean> {\n  return sendMessageToIframe(iframe, pendingMap, POST_MESSAGES.VALIDATE, data) as Promise<boolean>;\n}\nexport function resetPayment(iframe: HTMLIFrameElement | Element | undefined, pendingMap: Map<string, PendingRequest> | null): Promise<void> {\n  return sendMessageToIframe(iframe, pendingMap, POST_MESSAGES.RESET) as Promise<void>;\n}\nexport function sendConfig(iframe: HTMLIFrameElement | Element | undefined, pendingMap: Map<string, PendingRequest> | null, config: Pick<PayConductorConfig, \"intentToken\" | \"theme\" | \"locale\" | \"paymentMethods\" | \"defaultPaymentMethod\" | \"showPaymentButtons\" | \"nuPayConfig\">): Promise<void> {\n  return sendMessageToIframe(iframe, pendingMap, POST_MESSAGES.CONFIG, config) as Promise<void>;\n}\ntype MessagePayload = {\n  requestId?: string;\n  type?: string;\n  data?: PaymentResult | {\n    paymentMethod: PaymentMethod;\n  };\n  error?: {\n    message?: string;\n  };\n};\nexport function handleMessageEvent(event: MessageEvent, pendingMap: Map<string, PendingRequest> | null, setIsReady: (value: boolean) => void, setError: (value: string | null) => void, onReady?: () => void, onError?: (error: Error) => void, onPaymentComplete?: (data: PaymentResult) => void, onPaymentFailed?: (data: PaymentResult) => void, onPaymentPending?: (data: PaymentResult) => void, onPaymentMethodSelected?: (method: PaymentMethod) => void) {\n  if (!isValidOrigin(event.origin, ALLOWED_ORIGINS)) {\n    return;\n  }\n  const payload: MessagePayload = event.data;\n  const {\n    requestId,\n    type,\n    data,\n    error\n  } = payload;\n  if (requestId && pendingMap?.has(requestId)) {\n    const {\n      resolve,\n      reject\n    } = pendingMap.get(requestId)!;\n    pendingMap.delete(requestId);\n    if (error) {\n      reject(new Error(error.message));\n    } else {\n      resolve(data);\n    }\n    return;\n  }\n  if (type === POST_MESSAGES.READY) {\n    setIsReady(true);\n    onReady?.();\n    return;\n  }\n  if (type === POST_MESSAGES.ERROR) {\n    setError(error?.message || \"Unknown error\");\n    onError?.(new Error(error?.message));\n    return;\n  }\n  if (type === POST_MESSAGES.PAYMENT_COMPLETE) {\n    if (data && typeof data === \"object\" && \"status\" in data) {\n      onPaymentComplete?.(data);\n    }\n    return;\n  }\n  if (type === POST_MESSAGES.PAYMENT_FAILED) {\n    if (data && typeof data === \"object\" && \"status\" in data) {\n      onPaymentFailed?.(data);\n    }\n    return;\n  }\n  if (type === POST_MESSAGES.PAYMENT_PENDING) {\n    if (data && typeof data === \"object\" && \"status\" in data) {\n      onPaymentPending?.(data);\n    }\n    return;\n  }\n  if (type === POST_MESSAGES.PAYMENT_METHOD_SELECTED) {\n    if (data && typeof data === \"object\" && \"paymentMethod\" in data) {\n      onPaymentMethodSelected?.(data.paymentMethod);\n    }\n    return;\n  }\n}","\"use client\";\nimport * as React from \"react\";\nimport { useState, useRef, useEffect } from \"react\";\n\nexport interface PayConductorEmbedProps extends PayConductorConfig {\n  height?: string;\n  children?: any;\n  showActionButtons?: boolean;\n  onReady?: () => void;\n  onError?: (error: Error) => void;\n  onPaymentComplete?: (result: PaymentResult) => void;\n  onPaymentFailed?: (result: PaymentResult) => void;\n  onPaymentPending?: (result: PaymentResult) => void;\n  onPaymentMethodSelected?: (method: PaymentMethod) => void;\n}\n\nimport { IFRAME_DEFAULT_HEIGHT_VALUE } from \"./constants\";\nimport type {\n  PayConductorConfig,\n  PaymentMethod,\n  PaymentResult,\n} from \"./iframe/types\";\nimport {\n  confirmPayment,\n  createPendingRequestsMap,\n  handleMessageEvent,\n  resetPayment,\n  sendConfig,\n  validatePayment,\n} from \"./internal\";\nimport type {\n  PayConductorApi,\n  PayConductorFrame,\n  PayConductorState,\n  PendingRequest,\n} from \"./types\";\nimport { buildIframeUrl } from \"./utils\";\n\nfunction PayConductor(props: PayConductorEmbedProps) {\n  const iframeRef = useRef<any>(null);\n  const [isLoaded, setIsLoaded] = useState<PayConductorState[\"isLoaded\"]>(\n    () => false\n  );\n\n  const [isReady, setIsReady] = useState<PayConductorState[\"isReady\"]>(\n    () => false\n  );\n\n  const [error, setError] = useState<PayConductorState[\"error\"]>(() => null);\n\n  const [iframeUrl, setIframeUrl] = useState<PayConductorState[\"iframeUrl\"]>(\n    () => \"\"\n  );\n\n  const [pendingMap, setPendingMap] = useState<PayConductorState[\"pendingMap\"]>(\n    () => null\n  );\n\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState<\n    PayConductorState[\"selectedPaymentMethod\"]\n  >(() => null);\n\n  const [configSent, setConfigSent] = useState(() => false);\n\n  useEffect(() => {\n    setIframeUrl(\n      buildIframeUrl({\n        publicKey: props.publicKey,\n      })\n    );\n    setIsLoaded(true);\n    setPendingMap(createPendingRequestsMap());\n    const frame: PayConductorFrame = {\n      iframe: iframeRef.current,\n      get isReady() {\n        return isReady;\n      },\n      get error() {\n        return error;\n      },\n    };\n    const config: PayConductorConfig = {\n      publicKey: props.publicKey,\n      intentToken: props.intentToken,\n      theme: props.theme,\n      locale: props.locale,\n      paymentMethods: props.paymentMethods,\n      defaultPaymentMethod: props.defaultPaymentMethod,\n    };\n    const api: PayConductorApi = {\n      confirmPayment: (options: { intentToken: string }) =>\n        confirmPayment(iframeRef.current, pendingMap, options),\n      validate: (data: unknown) =>\n        validatePayment(iframeRef.current, pendingMap, data),\n      reset: () => resetPayment(iframeRef.current, pendingMap),\n      getSelectedPaymentMethod: () => selectedPaymentMethod,\n    };\n    window.PayConductor = {\n      frame,\n      config,\n      api,\n      selectedPaymentMethod: selectedPaymentMethod,\n    };\n    const sendConfigToIframe = async () => {\n      if (!configSent && iframeRef.current) {\n        setConfigSent(true);\n        sendConfig(iframeRef.current, pendingMap, {\n          intentToken: props.intentToken,\n          theme: props.theme,\n          locale: props.locale,\n          paymentMethods: props.paymentMethods,\n          defaultPaymentMethod: props.defaultPaymentMethod,\n          showPaymentButtons: props.showPaymentButtons,\n          nuPayConfig: props.nuPayConfig,\n        });\n      }\n    };\n    const eventHandler = (event: MessageEvent) => {\n      handleMessageEvent(\n        event,\n        pendingMap,\n        (val) => {\n          setIsReady(val);\n          if (val) {\n            sendConfigToIframe();\n          }\n        },\n        (val) => {\n          setError(val);\n        },\n        props.onReady,\n        props.onError,\n        (data) => props.onPaymentComplete?.(data as PaymentResult),\n        (data) => props.onPaymentFailed?.(data as PaymentResult),\n        (data) => props.onPaymentPending?.(data as PaymentResult),\n        (method) => {\n          setSelectedPaymentMethod(method);\n          if (window.PayConductor) {\n            window.PayConductor.selectedPaymentMethod = method;\n          }\n          props.onPaymentMethodSelected?.(method);\n        }\n      );\n    };\n    window.addEventListener(\"message\", eventHandler);\n  }, []);\n\n  return (\n    <div\n      className=\"payconductor\"\n      id=\"payconductor\"\n      style={{\n        width: \"100%\",\n        position: \"relative\",\n      }}\n    >\n      {props.children}\n      {isLoaded ? (\n        <iframe\n          allow=\"payment\"\n          title=\"PayConductor\"\n          ref={iframeRef}\n          src={iframeUrl}\n          style={{\n            width: \"100%\",\n            height: props.height || IFRAME_DEFAULT_HEIGHT_VALUE,\n            border: \"none\",\n          }}\n        />\n      ) : null}\n    </div>\n  );\n}\n\nexport default PayConductor;\n","import type { PayConductorConfig } from \"../iframe/types\";\nimport type { PayConductorFrame } from \"../types\";\ntype UsePayConductorReturn = PayConductorFrame & Partial<PayConductorConfig>;\nexport function usePayConductor(): UsePayConductorReturn {\n  const ctx = typeof window !== \"undefined\" ? window.PayConductor : null;\n  const config = ctx?.config ? {\n    publicKey: ctx.config.publicKey,\n    intentToken: ctx.config.intentToken,\n    theme: ctx.config.theme,\n    locale: ctx.config.locale\n  } : {};\n  const frame = ctx?.frame ? {\n    iframe: ctx.frame.iframe,\n    isReady: ctx.frame.isReady,\n    error: ctx.frame.error\n  } : {\n    iframe: null,\n    isReady: false,\n    error: null\n  };\n  return {\n    ...config,\n    ...frame\n  };\n}","import { POST_MESSAGES } from \"../constants\";\nimport type { BillingDetails, PayConductorConfig, PaymentMethod, PaymentResult } from \"../iframe/types\";\nimport { confirmPayment, createPendingRequestsMap, sendMessageToIframe } from \"../internal\";\nexport type SubmitResult = {\n  error?: {\n    message: string;\n    code?: string;\n    type?: \"validation_error\" | \"payment_error\";\n  };\n  paymentMethod?: PaymentMethod;\n};\nexport type ConfirmPaymentOptions = {\n  intentToken: string;\n  returnUrl?: string;\n};\nexport type UpdateOptions = {\n  billingDetails?: Partial<BillingDetails>;\n  address?: Partial<BillingDetails[\"address\"]>;\n};\nexport interface UseElementReturn {\n  confirmPayment: (options: ConfirmPaymentOptions) => Promise<PaymentResult>;\n  validate: (data: unknown) => Promise<boolean>;\n  reset: () => Promise<void>;\n  getSelectedPaymentMethod: () => PaymentMethod | null;\n  updateConfig: (config: Partial<Pick<PayConductorConfig, \"theme\" | \"locale\" | \"paymentMethods\">>) => void;\n  updateIntentToken: (intentToken: string) => void;\n  update: (options: UpdateOptions) => void;\n  submit: () => Promise<SubmitResult>;\n}\nfunction getIframeFromContext(ctx: typeof window.PayConductor): HTMLIFrameElement | null {\n  if (!ctx?.frame?.iframe) return null;\n  const iframeRef = ctx.frame.iframe;\n  if (iframeRef instanceof HTMLIFrameElement) {\n    return iframeRef;\n  }\n  if (iframeRef && typeof iframeRef === \"object\" && \"value\" in iframeRef) {\n    const value = iframeRef.value;\n    if (value instanceof HTMLIFrameElement) {\n      return value;\n    }\n  }\n  return null;\n}\nexport function useElement(): UseElementReturn {\n  const ctx = typeof window !== \"undefined\" ? window.PayConductor : null;\n  const sendToIframe = (type: string, data?: unknown) => {\n    if (!ctx) return;\n    const iframe = getIframeFromContext(ctx);\n    if (iframe?.contentWindow) {\n      iframe.contentWindow.postMessage({\n        type,\n        data\n      }, \"*\");\n    }\n  };\n  if (!ctx) {\n    return {\n      confirmPayment: async () => {\n        throw new Error(\"PayConductor not initialized\");\n      },\n      validate: async () => {\n        throw new Error(\"PayConductor not initialized\");\n      },\n      reset: async () => {\n        throw new Error(\"PayConductor not initialized\");\n      },\n      getSelectedPaymentMethod: () => null,\n      updateConfig: () => {\n        throw new Error(\"PayConductor not initialized\");\n      },\n      updateIntentToken: () => {\n        throw new Error(\"PayConductor not initialized\");\n      },\n      update: () => {\n        throw new Error(\"PayConductor not initialized\");\n      },\n      submit: async () => {\n        throw new Error(\"PayConductor not initialized\");\n      }\n    };\n  }\n  return {\n    confirmPayment: async (options: ConfirmPaymentOptions): Promise<PaymentResult> => {\n      const iframe = getIframeFromContext(ctx);\n      const pendingMap = createPendingRequestsMap();\n      if (!options.intentToken) {\n        throw new Error(\"Intent token is required\");\n      }\n      return confirmPayment(iframe || undefined, pendingMap, options);\n    },\n    validate: ctx.api.validate,\n    reset: ctx.api.reset,\n    getSelectedPaymentMethod: (): PaymentMethod | null => {\n      return ctx?.selectedPaymentMethod ?? null;\n    },\n    updateConfig: (config: Partial<Pick<PayConductorConfig, \"theme\" | \"locale\" | \"paymentMethods\">>) => {\n      const currentConfig = ctx.config;\n      sendToIframe(POST_MESSAGES.CONFIG, {\n        publicKey: currentConfig?.publicKey,\n        intentToken: currentConfig?.intentToken,\n        theme: config.theme ?? currentConfig?.theme,\n        locale: config.locale ?? currentConfig?.locale,\n        paymentMethods: config.paymentMethods ?? currentConfig?.paymentMethods\n      });\n    },\n    updateIntentToken: (intentToken: string) => {\n      const currentConfig = ctx.config;\n      sendToIframe(POST_MESSAGES.CONFIG, {\n        publicKey: currentConfig?.publicKey,\n        intentToken: intentToken,\n        theme: currentConfig?.theme,\n        locale: currentConfig?.locale,\n        paymentMethods: currentConfig?.paymentMethods\n      });\n    },\n    update: (options: UpdateOptions) => {\n      sendToIframe(POST_MESSAGES.UPDATE, options);\n    },\n    submit: async (): Promise<SubmitResult> => {\n      const iframe = getIframeFromContext(ctx);\n      const pendingMap = createPendingRequestsMap();\n      try {\n        await sendMessageToIframe(iframe || undefined, pendingMap, POST_MESSAGES.CONFIRM_PAYMENT, {});\n        return {\n          paymentMethod: undefined\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : \"Payment failed\";\n        return {\n          error: {\n            message,\n            code: \"payment_error\",\n            type: \"payment_error\"\n          }\n        };\n      }\n    }\n  };\n}"],"names":["IFRAME_BASE_URL_PROD","IFRAME_BASE_URL_DEV","REQUEST_TIMEOUT_MS","IFRAME_DEFAULT_HEIGHT","OutgoingMessage","IncomingMessage","isDev","IFRAME_BASE_URL","ALLOWED_ORIGINS","IFRAME_DEFAULT_HEIGHT_VALUE","REQUEST_TIMEOUT","POST_MESSAGES","ERROR_CODES","buildIframeUrl","config","params","generateRequestId","isValidOrigin","origin","allowedOrigins","createPendingRequestsMap","sendMessageToIframe","iframe","pendingMap","type","data","resolve","reject","requestId","confirmPayment","options","validatePayment","resetPayment","sendConfig","handleMessageEvent","event","setIsReady","setError","onReady","onError","onPaymentComplete","onPaymentFailed","onPaymentPending","onPaymentMethodSelected","payload","error","PayConductor","props","iframeRef","useRef","isLoaded","setIsLoaded","useState","isReady","iframeUrl","setIframeUrl","setPendingMap","selectedPaymentMethod","setSelectedPaymentMethod","configSent","setConfigSent","useEffect","frame","api","sendConfigToIframe","eventHandler","val","_a","method","jsxs","jsx","usePayConductor","ctx","getIframeFromContext","value","useElement","sendToIframe","currentConfig","intentToken"],"mappings":"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"}